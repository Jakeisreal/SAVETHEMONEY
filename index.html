<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>êµìœ¡ë¹„ ì˜ˆì‚° ìˆ˜ë¦½ í†µí•© ì–´ì‹œìŠ¤í„´íŠ¸ v2.2 (ì „ëµì—°ê³„)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
    :root {
      --primary: #2a63ff;
      --primary-light: #5790ff;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --info: #3b82f6;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body{
      font-family:'Pretendard','Segoe UI','Malgun Gothic',sans-serif;
      background:linear-gradient(135deg,#040b1c 0%,#0c2247 100%);
      min-height:100vh; padding:24px; color:#dbe7ff;
    }

    .save-status-bar{
      position:fixed; top:0; left:0; right:0; background:rgba(13,23,42,.98);
      border-bottom:1px solid rgba(61,88,135,.35); padding:12px 24px; z-index:999;
      display:flex; justify-content:space-between; align-items:center; backdrop-filter:blur(10px);
    }
    .save-status-bar .status-left{ display:flex; align-items:center; gap:16px; }
    .save-status-bar .status-right{ display:flex; gap:12px; }
    .save-btn{
      background:linear-gradient(135deg,#10b981 0%,#059669 100%); color:#fff;
      border:none; padding:6px 16px; border-radius:6px; font-weight:600; cursor:pointer; transition:.2s;
    }
    .save-btn:hover{ transform:translateY(-2px); }

    .wizard-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.95); z-index:10000;
      display:flex; align-items:center; justify-content:center; opacity:0; pointer-events:none; transition:opacity .3s;}
    .wizard-overlay.active{ opacity:1; pointer-events:all; }
    .wizard-container{
      background:linear-gradient(135deg,rgba(19,42,86,.98) 0%,rgba(23,60,109,.98) 100%);
      border:2px solid rgba(100,145,214,.5); border-radius:20px; padding:40px; max-width:900px; width:90%;
      box-shadow:0 30px 90px rgba(0,0,0,.8); max-height:90vh; overflow-y:auto;
    }
    .wizard-header{ text-align:center; margin-bottom:30px; }
    .wizard-header h2{ font-size:2em; margin-bottom:10px; color:#7fb3ff; }
    .wizard-progress{ display:flex; justify-content:space-between; margin:20px 0 30px; }
    .wizard-step{ flex:1; text-align:center; position:relative; }
    .wizard-step::before{ content:''; position:absolute; top:15px; left:50%; right:-50%; height:2px; 
      background:rgba(63,88,135,.4); z-index:-1; }
    .wizard-step:last-child::before{ display:none; }
    .wizard-step.completed::before{ background:var(--success); }
    .wizard-step.active::before{ background:var(--info); }
    .wizard-step-circle{ width:30px; height:30px; border-radius:50%; margin:0 auto 8px;
      background:rgba(63,88,135,.4); color:#8fa8d9; display:flex; align-items:center; justify-content:center;
      font-size:.9em; font-weight:700; }
    .wizard-step.completed .wizard-step-circle{ background:var(--success); color:#fff; }
    .wizard-step.active .wizard-step-circle{ background:var(--info); color:#fff; }
    .wizard-step-label{ font-size:.85em; color:#9cb5e9; }
    .wizard-content{ background:rgba(10,23,45,.6); padding:30px; border-radius:12px; margin-bottom:20px; }
    .wizard-buttons{ display:flex; gap:15px; justify-content:flex-end; }

    .tooltip-wrapper{ position:relative; display:inline-block; }
    .tooltip-icon{ display:inline-flex; align-items:center; justify-content:center; width:18px; height:18px;
      border-radius:50%; background:rgba(59,130,246,.3); color:#7fb3ff; font-size:.7em; font-weight:700;
      cursor:help; margin-left:6px; }
    .tooltip-text{ visibility:hidden; position:absolute; bottom:125%; left:50%; transform:translateX(-50%);
      background:rgba(10,20,40,.98); color:#e3ecff; padding:10px 14px; border-radius:8px; font-size:.85rem;
      white-space:nowrap; z-index:1000; border:1px solid rgba(100,145,214,.5); opacity:0; transition:.3s;
      box-shadow:0 10px 30px rgba(0,0,0,.5); }
    .tooltip-icon:hover + .tooltip-text{ visibility:visible; opacity:1; }

    .info-card{ background:linear-gradient(135deg,rgba(59,130,246,.15) 0%,rgba(37,99,235,.15) 100%);
      border:1px solid rgba(59,130,246,.4); border-radius:12px; padding:16px; margin-bottom:16px; }
    .info-card-title{ color:#7fb3ff; font-weight:600; margin-bottom:8px; display:flex; align-items:center; gap:8px; }
    .info-card-content{ font-size:.9em; color:#c3d6ff; line-height:1.6; }

    .container{ max-width:1680px; margin:60px auto 0; background:rgba(13,23,42,.92); border-radius:18px;
      border:1px solid rgba(61,88,135,.35); box-shadow:0 28px 120px rgba(2,8,20,.65); overflow:hidden; }
    .header{ background:linear-gradient(135deg,rgba(19,42,86,.96) 0%,rgba(23,60,109,.96) 100%);
      color:#f6f8ff; padding:40px 48px; }
    .header h1{ font-size:2.4em; font-weight:700; margin-bottom:12px; }
    .header p{ font-size:1.05em; opacity:.92; line-height:1.7; }
    .header-actions{ display:flex; gap:12px; margin-top:20px; flex-wrap:wrap; }

    .tabs{ display:flex; border-bottom:1px solid rgba(63,96,149,.45); background:rgba(9,20,42,.85); overflow-x:auto; }
    .tab{ padding:18px 20px; text-align:center; cursor:pointer; border:none; background:transparent;
      font-weight:600; color:#8fa8d9; transition:.3s; white-space:nowrap; }
    .tab:hover{ background:rgba(35,59,107,.45); }
    .tab.active{ background:rgba(16,34,70,.8); color:#7fb3ff; border-bottom:3px solid #7fb3ff; }

    .content{ padding:38px 48px 48px; }
    .tab-content{ display:none; animation:fadeIn .25s ease-out; }
    .tab-content.active{ display:block; }
    @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }

    .section-card{ background:rgba(15,27,49,.92); border:1px solid rgba(63,88,135,.4); border-radius:16px;
      padding:28px 32px; margin-bottom:32px; box-shadow:0 16px 50px rgba(2,12,32,.6); }
    .section-header{ display:flex; justify-content:space-between; align-items:flex-start; gap:16px; margin-bottom:20px; flex-wrap:wrap; }
    .section-header h2{ font-size:1.4em; color:#e3ecff; display:flex; align-items:center; gap:10px; }
    .section-desc{ font-size:.92em; color:#9cb5e9; margin-top:4px; line-height:1.6; }

    .button{ border:none; border-radius:8px; padding:10px 18px; font-weight:600; cursor:pointer;
      transition:.2s; display:inline-flex; align-items:center; gap:6px; font-size:.9em; }
    .button-primary{ background:linear-gradient(135deg,#2a63ff 0%,#5790ff 100%); color:#f5f9ff; }
    .button-secondary{ background:rgba(35,55,96,.85); color:#c3d6ff; }
    .button-success{ background:linear-gradient(135deg,var(--success) 0%,#059669 100%); color:#fff; }
    .button-tertiary{ background:rgba(27,42,75,.75); color:#b8c8ec; }
    .button:hover{ transform:translateY(-2px); box-shadow:0 14px 32px rgba(39,88,188,.45); }
    .button:disabled{ opacity:.5; cursor:not-allowed; transform:none; }

    .field-grid{ display:grid; gap:16px; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); margin-bottom:20px; }
    .field{ display:flex; flex-direction:column; gap:6px; }
    .field label{ font-size:.86em; color:#9cb5e9; font-weight:600; display:flex; align-items:center; }
    .field input, .field select{ width:100%; padding:8px 10px; border:1px solid rgba(78,114,174,.6);
      border-radius:8px; font-size:.92em; background:rgba(11,24,46,.9); color:#f0f6ff; transition:.3s; }
    .field input:focus, .field select:focus{ outline:none; border-color:rgba(118,170,255,.9);
      box-shadow:0 0 0 3px rgba(89,143,231,.35); }

    .metrics-grid{ display:grid; gap:16px; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); }
    .metric-card{ background:linear-gradient(135deg,rgba(39,77,140,.5) 0%,rgba(24,48,92,.65) 100%);
      padding:18px 20px; border-radius:14px; }
    .metric-card h4{ font-size:.9em; color:#b2c6f2; margin-bottom:8px; }
    .metric-card p{ font-size:1.28em; font-weight:700; color:#f2f6ff; }
    .metric-card .mini{ font-size:.75em; color:#9cb5e9; display:block; margin-top:4px; }

    table{ width:100%; border-collapse:collapse; }
    th,td{ padding:10px 12px; border-bottom:1px solid rgba(63,88,135,.38); text-align:left; font-size:.92em; }
    th{ background:rgba(31,59,110,.75); color:#f1f6ff; font-weight:600; }
    td{ color:#d8e6ff; }
    tr:hover{ background:rgba(24,46,89,.55); }

    .chart-container{ position:relative; height:350px; margin:20px 0; }
    
    .report-section{ margin-bottom:28px; }
    .report-section h3{ font-size:1.2em; color:#aac4ff; margin-bottom:12px; border-bottom:2px solid rgba(100,145,214,.3); padding-bottom:8px; }
    .report-kpi{ display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:14px; margin:16px 0; }
    .report-kpi-item{ background:rgba(24,48,88,.75); border-radius:10px; padding:14px; }
    .report-kpi-label{ display:block; font-size:.82em; color:#8ea9de; margin-bottom:6px; }
    .report-kpi-value{ font-size:1.3em; color:#f3f7ff; font-weight:700; }

    .quick-actions{ position:fixed; bottom:30px; right:30px; z-index:1000; display:flex; flex-direction:column; gap:12px; }
    .quick-action-btn{ width:56px; height:56px; border-radius:50%; border:none;
      background:linear-gradient(135deg,var(--primary) 0%,var(--primary-light) 100%);
      color:#fff; font-size:1.5em; cursor:pointer; box-shadow:0 8px 24px rgba(42,99,255,.4);
      transition:.3s; display:flex; align-items:center; justify-content:center; }
    .quick-action-btn:hover{ transform:translateY(-3px); box-shadow:0 12px 32px rgba(42,99,255,.6); }

    .toggle-section{ margin:20px 0; }
    .toggle-header{ display:flex; align-items:center; gap:12px; padding:12px; background:rgba(24,48,88,.6);
      border-radius:8px; cursor:pointer; transition:.3s; }
    .toggle-header:hover{ background:rgba(24,48,88,.8); }
    .toggle-icon{ font-size:1.2em; transition:.3s; }
    .toggle-section.collapsed .toggle-icon{ transform:rotate(-90deg); }
    .toggle-content{ margin-top:16px; display:block; }
    .toggle-section.collapsed .toggle-content{ display:none; }

    .info-badge{ background:rgba(59,130,246,.3); padding:4px 12px; border-radius:999px; font-size:.85em; display:inline-block; }

    @media print {
      body{ background:#fff; color:#000; }
      .header, .tabs, .quick-actions, .button, .save-status-bar{ display:none !important; }
      .container{ box-shadow:none; border:none; margin-top:0; }
      .section-card{ page-break-inside:avoid; }
    }
  </style>
</head>
<body>
  <div class="save-status-bar">
    <div class="status-left">
      <div style="font-weight:600;color:#7fb3ff;">ğŸ“Š êµìœ¡ë¹„ ì˜ˆì‚° ìˆ˜ë¦½ v2.2</div>
      <div id="saveStatus" style="color:#9cb5e9;font-size:.85em;">ì €ì¥ëœ ë°ì´í„° ì—†ìŒ</div>
    </div>
    <div class="status-right">
      <button class="save-btn" onclick="manualSave()">ğŸ’¾ ì €ì¥</button>
      <button class="button button-secondary" style="padding:6px 16px;font-size:.85em;" onclick="clearAllData()">ğŸ—‘ï¸ ì´ˆê¸°í™”</button>
    </div>
  </div>

  <div class="wizard-overlay" id="wizardOverlay">
    <div class="wizard-container">
      <div class="wizard-header">
        <h2>ğŸ“ êµìœ¡ë¹„ ì˜ˆì‚° ìˆ˜ë¦½ ë§ˆë²•ì‚¬</h2>
        <p style="color:#c3d6ff;">ë‹¨ 4ë‹¨ê³„ë¡œ ì „ë¬¸ê°€ì²˜ëŸ¼ ì˜ˆì‚°ì„ ìˆ˜ë¦½í•˜ì„¸ìš”</p>
      </div>
      
      <div class="wizard-progress" id="wizardProgress">
        <div class="wizard-step active" data-step="1">
          <div class="wizard-step-circle">1</div>
          <div class="wizard-step-label">ê¸°ë³¸ ì •ë³´</div>
        </div>
        <div class="wizard-step" data-step="2">
          <div class="wizard-step-circle">2</div>
          <div class="wizard-step-label">ì§ì›/ê·¼ë¬´ì§€</div>
        </div>
        <div class="wizard-step" data-step="3">
          <div class="wizard-step-circle">3</div>
          <div class="wizard-step-label">êµìœ¡ í”„ë¡œê·¸ë¨</div>
        </div>
        <div class="wizard-step" data-step="4">
          <div class="wizard-step-circle">4</div>
          <div class="wizard-step-label">ì™„ë£Œ</div>
        </div>
      </div>

      <div class="wizard-content" id="wizardContent"></div>

      <div class="wizard-buttons">
        <button class="button button-secondary" id="wizardPrev" style="display:none;">â† ì´ì „</button>
        <button class="button button-primary" id="wizardNext">ë‹¤ìŒ â†’</button>
        <button class="button button-success" id="wizardFinish" style="display:none;">ì™„ë£Œ âœ“</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="header">
      <h1>ğŸ“Š êµìœ¡ë¹„ ì˜ˆì‚° ìˆ˜ë¦½ ì–´ì‹œìŠ¤í„´íŠ¸</h1>
      <p>AI ê¸°ë°˜ ìŠ¤ë§ˆíŠ¸ ì˜ˆì‚° ìˆ˜ë¦½ ë„êµ¬ - ì´ˆë³´ìë„ 10ë¶„ì´ë©´ ì „ë¬¸ê°€ê¸‰ ì˜ˆì‚°ì•ˆ ì™„ì„±</p>
      <div class="header-actions">
        <button class="button button-primary" onclick="showWizard()">ğŸ§™ ì„¤ì • ë§ˆë²•ì‚¬ ì‹œì‘</button>
        <button class="button button-secondary" onclick="loadSample()">ğŸ“ ìƒ˜í”Œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
        <button class="button button-success" onclick="manualSave()">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
        <button class="button button-secondary" onclick="exportData()">ğŸ“¥ ë‚´ë³´ë‚´ê¸°</button>
      </div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchTab('quick')">ë¹ ë¥¸ì‹œì‘</button>
      <button class="tab" onclick="switchTab('employee')">ì§ì›êµ¬ì„±</button>
      <button class="tab" onclick="switchTab('location')">ê·¼ë¬´ì§€ì—­</button>
      <button class="tab" onclick="switchTab('plan')">êµìœ¡ê³„íš</button>
      <button class="tab" onclick="switchTab('summary')">ì˜ˆì‚°ìš”ì•½</button>
      <button class="tab" onclick="switchTab('dashboard')">ëŒ€ì‹œë³´ë“œ</button>
      <button class="tab" onclick="switchTab('report')">ê²½ì˜ë³´ê³ ì„œ</button>
      <button class="tab" onclick="switchTab('advanced')">ê³ ê¸‰ì„¤ì •</button>
    </div>

    <div class="content">
      <div id="quick" class="tab-content active"></div>
      <div id="employee" class="tab-content"></div>
      <div id="location" class="tab-content"></div>
      <div id="plan" class="tab-content"></div>
      <div id="summary" class="tab-content"></div>
      <div id="dashboard" class="tab-content"></div>
      <div id="report" class="tab-content"></div>
      <div id="advanced" class="tab-content"></div>
    </div>
  </div>

  <div class="quick-actions">
    <button class="quick-action-btn" onclick="showWizard()" title="ì„¤ì • ë§ˆë²•ì‚¬">ğŸ§™</button>
    <button class="quick-action-btn" onclick="window.print()" title="ì¸ì‡„í•˜ê¸°">ğŸ–¨ï¸</button>
    <button class="quick-action-btn" onclick="window.scrollTo({top:0,behavior:'smooth'})" title="ë§¨ ìœ„ë¡œ">â†‘</button>
  </div>

  <script>
    // ìƒíƒœ ê´€ë¦¬
    const STORAGE_KEY = 'educationBudgetData_v2';
    let autoSaveTimer = null;

    const state = {
      year: new Date().getFullYear() + 1,
      totalHeadcount: 250,
      totalBudget: 500000000,
      previousYearBudget: 450000000, // â­ NEW: ì „ë…„ë„ ì˜ˆì‚° ì¶”ê°€
      leadershipRatio: 15,
      jobRatio: 45,
      hierarchyRatio: 15,
      legalRatio: 25,
      programs: [],
      wizardStep: 1,
      wizardCompleted: false,
      lastSaved: null,
      
      employeeComposition: {
        junior: 100,
        senior: 80,
        manager: 50,
        executive: 20
      },
      
      locationDistribution: {
        yeongcheon: { name: 'ì˜ì²œ', count: 120, customerTrainingCost: 300000 },
        gyeongsan: { name: 'ê²½ì‚°', count: 80, customerTrainingCost: 320000 },
        yesan: { name: 'ì˜ˆì‚°', count: 30, customerTrainingCost: 350000 },
        anyang: { name: 'ì•ˆì–‘', count: 20, customerTrainingCost: 380000 }
      },
      
      jobEducationPolicy: {
        junior: { 
          customerTraining: true,
          externalTraining: true,
          externalSessions: 2,
          externalUnitCost: 550000
        },
        senior: { 
          customerTraining: true, 
          externalTraining: true,
          externalSessions: 2,
          externalUnitCost: 600000
        },
        manager: { 
          customerTraining: true, 
          externalTraining: false,
          externalSessions: 0,
          externalUnitCost: 0
        },
        executive: { 
          customerTraining: false,
          externalTraining: false,
          externalSessions: 0,
          externalUnitCost: 0
        }
      },
      
      hierarchyPrograms: {
        newEmployee: { name: 'ì‹ ì…ì‚¬ì› ì…ë¬¸êµìœ¡', count: 15, unitCost: 500000 },
        retirement: { name: 'ì •ë…„í‡´ì§ ì¬ì·¨ì—…ì§€ì›', count: 5, unitCost: 300000 }
      }
    };
    
    // â­ NEW: ì „ëµ ëª©í‘œ ìƒìˆ˜
    const STRATEGY_GOALS = {
      digital: 'ë””ì§€í„¸ ì „í™˜ (DT)',
      leadership: 'í•µì‹¬ì¸ì¬/ë¦¬ë”ì‹­',
      job: 'ì§ë¬´ ì „ë¬¸ì„± ê°•í™”',
      global: 'ê¸€ë¡œë²Œ ì—­ëŸ‰',
      compliance: 'ë²•ê·œ ì¤€ìˆ˜ (ESG)',
      culture: 'ì¡°ì§ ë¬¸í™”',
      other: 'ê¸°íƒ€'
    };

    // ìë™ì €ì¥ í•¨ìˆ˜
    function autoSave() {
      if (autoSaveTimer) clearTimeout(autoSaveTimer);
      
      autoSaveTimer = setTimeout(() => {
        saveToLocalStorage();
        showSaveNotification('ìë™ ì €ì¥ë¨');
      }, 2000);
    }

    function saveToLocalStorage() {
      try {
        state.lastSaved = new Date().toISOString();
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        updateSaveStatus();
        return true;
      } catch (e) {
        console.error('ì €ì¥ ì‹¤íŒ¨:', e);
        showSaveNotification('ì €ì¥ ì‹¤íŒ¨', true);
        return false;
      }
    }

    function loadFromLocalStorage() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
          const data = JSON.parse(saved);
          // ì´ì „ ë²„ì „ì— ì—†ë˜ ê°’ ê¸°ë³¸ê°’ í• ë‹¹
          if (!data.previousYearBudget) data.previousYearBudget = 450000000;
          if (data.programs && !data.programs[0]?.strategicGoal) {
            data.programs.forEach((p, i) => {
              p.strategicGoal = 'other';
              p.executionQuarter = (i % 4) + 1;
            });
          }
          Object.assign(state, data);
          updateSaveStatus();
          return true;
        }
      } catch (e) {
        console.error('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', e);
      }
      return false;
    }

    function showSaveNotification(message, isError = false) {
      const existing = document.getElementById('saveNotification');
      if (existing) existing.remove();

      const notification = document.createElement('div');
      notification.id = 'saveNotification';
      notification.style.cssText = `
        position: fixed;
        top: 80px;
        right: 30px;
        background: ${isError ? 'linear-gradient(135deg, #ef4444, #dc2626)' : 'linear-gradient(135deg, #10b981, #059669)'};
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 8px 24px rgba(0,0,0,0.3);
        z-index: 10001;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 8px;
      `;
      notification.innerHTML = `${isError ? 'âš ï¸' : 'âœ…'} ${message}`;
      document.body.appendChild(notification);

      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transition = 'opacity 0.3s';
        setTimeout(() => notification.remove(), 300);
      }, 2000);
    }

    function updateSaveStatus() {
      const statusEl = document.getElementById('saveStatus');
      if (statusEl && state.lastSaved) {
        const savedDate = new Date(state.lastSaved);
        const now = new Date();
        const diffMinutes = Math.floor((now - savedDate) / 60000);
        
        let timeText;
        if (diffMinutes < 1) timeText = 'ë°©ê¸ˆ ì „';
        else if (diffMinutes < 60) timeText = `${diffMinutes}ë¶„ ì „`;
        else timeText = savedDate.toLocaleTimeString('ko-KR');
        
        statusEl.innerHTML = `ğŸ’¾ ë§ˆì§€ë§‰ ì €ì¥: ${timeText}`;
      }
    }

    function manualSave() {
      if (saveToLocalStorage()) {
        showSaveNotification('ì €ì¥ ì™„ë£Œ');
      }
    }

    // ìœ í‹¸ë¦¬í‹°
    function formatKRW(n) {
      n = Math.floor(Number(n) || 0);
      if (n === 0) return '0ì›';
      const eok = Math.floor(n / 1e8);
      const man = Math.floor((n % 1e8) / 1e4);
      const won = n % 1e4;
      const parts = [];
      if (eok > 0) parts.push(`${eok}ì–µ`);
      if (man > 0) parts.push(`${man}ë§Œ`);
      if (won > 0) parts.push(`${won}`);
      return parts.join(' ') + 'ì›';
    }

    function formatNumber(n) {
      return Number(n || 0).toLocaleString('ko-KR');
    }

    // ë§ˆë²•ì‚¬
    function showWizard() {
      state.wizardStep = 1;
      document.getElementById('wizardOverlay').classList.add('active');
      renderWizardStep();
    }

    function renderWizardStep() {
      const step = state.wizardStep;
      const content = document.getElementById('wizardContent');
      const prev = document.getElementById('wizardPrev');
      const next = document.getElementById('wizardNext');
      const finish = document.getElementById('wizardFinish');

      document.querySelectorAll('.wizard-step').forEach((el, i) => {
        el.classList.remove('active', 'completed');
        if (i + 1 < step) el.classList.add('completed');
        if (i + 1 === step) el.classList.add('active');
      });

      prev.style.display = step > 1 ? 'block' : 'none';
      next.style.display = step < 4 ? 'block' : 'none';
      finish.style.display = step === 4 ? 'block' : 'none';

      if (step === 1) {
        content.innerHTML = `
          <div class="info-card">
            <div class="info-card-title">ğŸ’¡ êµìœ¡ë¹„ ì˜ˆì‚°ì˜ ê¸°ë³¸</div>
            <div class="info-card-content">
              ê¸°ì—… êµìœ¡ë¹„ëŠ” ì¼ë°˜ì ìœ¼ë¡œ <strong>ì´ ì¸ê±´ë¹„ì˜ 1.5~3%</strong> ìˆ˜ì¤€ì…ë‹ˆë‹¤.
              ë²•ì •ì˜ë¬´êµìœ¡ì€ <strong>ì¸ë‹¹ ì—°ê°„ 8~15ë§Œì›</strong>, ì§ë¬´êµìœ¡ì€ <strong>ì¸ë‹¹ 50~100ë§Œì›</strong>ì´ í‰ê· ì…ë‹ˆë‹¤.
            </div>
          </div>
          <div class="field-grid" style="grid-template-columns: 1fr 1fr;">
            <div class="field">
              <label>ì˜ˆì‚° ì—°ë„
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">ìˆ˜ë¦½í•  êµìœ¡ë¹„ ì˜ˆì‚°ì˜ ì—°ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”</span>
                </span>
              </label>
              <input type="number" value="${state.year}" onchange="state.year=+this.value" min="2024" max="2030">
            </div>
            <div class="field">
              <label>ì „ì²´ ì„ì§ì› ìˆ˜
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">êµìœ¡ ëŒ€ìƒ ì „ì²´ ì¸ì›ì…ë‹ˆë‹¤</span>
                </span>
              </label>
              <input type="number" value="${state.totalHeadcount}" onchange="state.totalHeadcount=+this.value;updateBudgetEstimate()" min="1">
            </div>
          </div>
          <div class="field-grid">
            <div class="field">
              <label>
                â­ (ì‹ ê·œ) ì „ë…„ë„ ì´ ì˜ˆì‚° (ì›)
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">YoY ë¹„êµë¥¼ ìœ„í•´ ì „ë…„ë„ ì˜ˆì‚°ì„ ì…ë ¥</span>
                </span>
              </label>
              <input type="text" value="${formatNumber(state.previousYearBudget)}" 
                onchange="state.previousYearBudget=Number(this.value.replace(/,/g,''))||0;this.value=formatNumber(state.previousYearBudget);">
              <div style="font-size:.85em;color:#9cb5e9;margin-top:4px;">${formatKRW(state.previousYearBudget)}</div>
            </div>
            <div class="field">
              <label>ì˜¬í•´ í¬ë§ ì´ ì˜ˆì‚° (ì›)
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">í™•ë³´ ê°€ëŠ¥í•œ ì´ êµìœ¡ë¹„ ì˜ˆì‚°ì…ë‹ˆë‹¤</span>
                </span>
              </label>
              <input type="text" value="${formatNumber(state.totalBudget)}" 
                onchange="state.totalBudget=Number(this.value.replace(/,/g,''))||0;this.value=formatNumber(state.totalBudget);updateBudgetEstimate()">
              <div style="font-size:.85em;color:#9cb5e9;margin-top:4px;">${formatKRW(state.totalBudget)}</div>
            </div>
          </div>
        `;
      } else if (step === 2) {
        // ... (step 2 ì½”ë“œëŠ” ë³€ê²½ ì—†ìŒ) ...
        const comp = state.employeeComposition;
        const locations = state.locationDistribution;
        const totalLocationCount = Object.values(locations).reduce((sum, loc) => sum + loc.count, 0);
        
        content.innerHTML = `
          <div class="info-card">
            <div class="info-card-title">ğŸ‘¥ ì§ì› êµ¬ì„± ë° ê·¼ë¬´ì§€ ì„¤ì •</div>
            <div class="info-card-content">
              ì§ê¸‰ë³„ ì¸ì›ê³¼ ê·¼ë¬´ì§€ë³„ ì¸ì›ì„ ì…ë ¥í•˜ì„¸ìš”. <strong>ì£¼ì„/ì„ ì„</strong>ì€ ê³ ê°ì‚¬ êµìœ¡ + ì™¸ë¶€ êµìœ¡ ëŒ€ìƒì…ë‹ˆë‹¤.
            </div>
          </div>
          
          <h4 style="color:#7fb3ff;margin:20px 0 12px;">ğŸ“Š ì§ê¸‰ë³„ ì¸ì›</h4>
          <div class="field-grid">
            <div class="field">
              <label>ì£¼ì„ â­
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">ê³ ê°ì‚¬ + ì™¸ë¶€ êµìœ¡ ê°€ëŠ¥ (ì—° 2íšŒ)</span>
                </span>
              </label>
              <input type="number" value="${comp.junior}" 
                onchange="state.employeeComposition.junior=+this.value;updateTotalHeadcount();renderWizardStep()" min="0">
            </div>
            <div class="field">
              <label>ì„ ì„ â­â­
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">ê³ ê°ì‚¬ + ì™¸ë¶€ êµìœ¡ ê°€ëŠ¥ (ì—° 2íšŒ)</span>
                </span>
              </label>
              <input type="number" value="${comp.senior}" 
                onchange="state.employeeComposition.senior=+this.value;updateTotalHeadcount();renderWizardStep()" min="0">
            </div>
            <div class="field">
              <label>ì±…ì„
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">ê³ ê°ì‚¬ êµìœ¡ë§Œ ìˆ˜ê°•</span>
                </span>
              </label>
              <input type="number" value="${comp.manager}" 
                onchange="state.employeeComposition.manager=+this.value;updateTotalHeadcount();renderWizardStep()" min="0">
            </div>
            <div class="field">
              <label>ì„ì›
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">ë¦¬ë”ì‹­ êµìœ¡ ëŒ€ìƒ</span>
                </span>
              </label>
              <input type="number" value="${comp.executive}" 
                onchange="state.employeeComposition.executive=+this.value;updateTotalHeadcount();renderWizardStep()" min="0">
            </div>
          </div>
          
          <h4 style="color:#7fb3ff;margin:24px 0 12px;">ğŸ¢ ê·¼ë¬´ì§€ë³„ ì¸ì› ë° ê³ ê°ì‚¬ êµìœ¡ ë‹¨ê°€</h4>
          <div class="info-card" style="margin-bottom:16px;background:linear-gradient(135deg,rgba(251,191,36,.15) 0%,rgba(245,158,11,.15) 100%);border-color:rgba(251,191,36,.4);">
            <div class="info-card-title" style="color:#fbbf24;">ğŸ’¡ ì¤‘ìš”: ê·¼ë¬´ì§€ë³„ ì„¤ì •</div>
            <div class="info-card-content">
              ê° ê·¼ë¬´ì§€ì—ì„œ ì§„í–‰í•˜ëŠ” <strong>ê³ ê°ì‚¬ êµìœ¡ ë‹¨ê°€ê°€ ë‹¤ë¦…ë‹ˆë‹¤</strong>. ì§€ì—­ë³„ ì¸ì›ê³¼ ë‹¨ê°€ë¥¼ ì •í™•íˆ ì…ë ¥í•˜ì„¸ìš”.<br>
              <strong>ê·¼ë¬´ì§€ë³„ ì¸ì› í•©ê³„(${totalLocationCount}ëª…)</strong>ê°€ ì „ì²´ ì¸ì›(${state.totalHeadcount}ëª…)ê³¼ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
            </div>
          </div>
          
          <table style="margin-top:12px;">
            <thead>
              <tr>
                <th>ê·¼ë¬´ì§€ì—­</th>
                <th>ì¸ì› (ëª…)</th>
                <th>ê³ ê°ì‚¬ êµìœ¡ ë‹¨ê°€ (ì›)</th>
                <th>ì§€ì—­ë³„ ì˜ˆì‚°</th>
              </tr>
            </thead>
            <tbody>
              ${Object.entries(locations).map(([key, loc]) => {
                const locationBudget = loc.count * loc.customerTrainingCost;
                return `
                  <tr>
                    <td><strong>${loc.name}</strong></td>
                    <td><input type="number" value="${loc.count}" onchange="updateLocationInWizard('${key}','count',+this.value)" style="width:100px;" min="0"></td>
                    <td>
                      <input type="text" value="${formatNumber(loc.customerTrainingCost)}" 
                        onchange="updateLocationInWizard('${key}','customerTrainingCost',Number(this.value.replace(/,/g,'')))" 
                        style="width:140px;">
                    </td>
                    <td><strong>${formatKRW(locationBudget)}</strong></td>
                  </tr>
                `;
              }).join('')}
            </tbody>
            <tfoot style="background:rgba(31,59,110,.9);">
              <tr>
                <th>í•©ê³„</th>
                <th>${formatNumber(totalLocationCount)}ëª…</th>
                <th></th>
                <th><strong>${formatKRW(Object.values(locations).reduce((sum, loc) => sum + loc.count * loc.customerTrainingCost, 0))}</strong></th>
              </tr>
            </tfoot>
          </table>
          
          ${totalLocationCount !== state.totalHeadcount ? `
          <div class="info-card" style="margin-top:16px;background:linear-gradient(135deg,rgba(239,68,68,.15) 0%,rgba(220,38,38,.15) 100%);border-color:rgba(239,68,68,.4);">
            <div class="info-card-title" style="color:#ef4444;">âš ï¸ ì¸ì› ë¶ˆì¼ì¹˜</div>
            <div class="info-card-content">
              ê·¼ë¬´ì§€ë³„ ì¸ì› í•©ê³„(${formatNumber(totalLocationCount)}ëª…)ê°€ ì „ì²´ ì¸ì›(${formatNumber(state.totalHeadcount)}ëª…)ê³¼ ë‹¤ë¦…ë‹ˆë‹¤.<br>
              <strong>ë°˜ë“œì‹œ ì¼ì¹˜ì‹œì¼œì•¼ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</strong>
            </div>
          </div>
          ` : ''}
        `;
      } else if (step === 3) {
        // ... (step 3 ì½”ë“œëŠ” ë³€ê²½ ì—†ìŒ) ...
        content.innerHTML = `
          <div class="info-card">
            <div class="info-card-title">ğŸ“š ì£¼ìš” êµìœ¡ í”„ë¡œê·¸ë¨ ì„¤ì •</div>
            <div class="info-card-content">
              íšŒì‚¬ì—ì„œ ì‹¤ì‹œí•  ì£¼ìš” êµìœ¡ ê³¼ì •ì„ ì…ë ¥í•˜ì„¸ìš”. ë‚˜ì¤‘ì— ì¶”ê°€/ìˆ˜ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.
            </div>
          </div>
          <div class="field-grid">
            <div class="field">
              <label>ë¦¬ë”ì‹­ êµìœ¡ ë¹„ì¤‘ (%)
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">ì„ì›/ì±…ì„ ëŒ€ìƒ ë¦¬ë”ì‹­ êµìœ¡ ë¹„ì¤‘</span>
                </span>
              </label>
              <input type="number" value="${state.leadershipRatio}" onchange="state.leadershipRatio=+this.value" min="0" max="100">
            </div>
            <div class="field">
              <label>ì§ë¬´êµìœ¡ ë¹„ì¤‘ (%)
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">ê³ ê°ì‚¬ êµìœ¡ + ì™¸ë¶€ ì „ë¬¸êµìœ¡</span>
                </span>
              </label>
              <input type="number" value="${state.jobRatio}" onchange="state.jobRatio=+this.value" min="0" max="100">
            </div>
            <div class="field">
              <label>ê³„ì¸µë³„ êµìœ¡ ë¹„ì¤‘ (%)
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">ì‹ ì…ì‚¬ì›, ì •ë…„í‡´ì§ì ë“± íŠ¹ì • ê³„ì¸µ êµìœ¡</span>
                </span>
              </label>
              <input type="number" value="${state.hierarchyRatio}" onchange="state.hierarchyRatio=+this.value" min="0" max="100">
            </div>
            <div class="field">
              <label>ë²•ì •ì˜ë¬´êµìœ¡ ë¹„ì¤‘ (%)
                <span class="tooltip-wrapper">
                  <span class="tooltip-icon">?</span>
                  <span class="tooltip-text">ì‚°ì—…ì•ˆì „, ì„±í¬ë¡±ì˜ˆë°© ë“± í•„ìˆ˜ êµìœ¡ ë¹„ì¤‘</span>
                </span>
              </label>
              <input type="number" value="${state.legalRatio}" onchange="state.legalRatio=+this.value" min="0" max="100">
            </div>
          </div>
          <div class="info-card" style="margin-top:20px;background:linear-gradient(135deg,rgba(16,185,129,.15) 0%,rgba(5,150,105,.15) 100%);border-color:rgba(16,185,129,.4);">
            <div class="info-card-title" style="color:var(--success);">âœ… ì—…ê³„ í‘œì¤€ í”„ë¡œê·¸ë¨ ìë™ ì¶”ê°€</div>
            <div class="info-card-content">
              âœ“ <strong>ë¦¬ë”ì‹­</strong>: ì„ì›/ì±…ì„ ì›Œí¬ìƒµ<br>
              âœ“ <strong>ì§ë¬´</strong>: ê³ ê°ì‚¬ êµìœ¡(ì§€ì—­ë³„), ì™¸ë¶€ ì „ë¬¸êµìœ¡(ì£¼ì„/ì„ ì„)<br>
              âœ“ <strong>ê³„ì¸µ</strong>: ì‹ ì…ì‚¬ì› ì…ë¬¸êµìœ¡, ì •ë…„í‡´ì§ ì¬ì·¨ì—…ì§€ì›<br>
              âœ“ <strong>ë²•ì •</strong>: ì‚°ì—…ì•ˆì „, ì§ì¥ ë‚´ ê´´ë¡­í˜ ì˜ˆë°© ë“±
            </div>
          </div>
        `;
      } else if (step === 4) {
        // ... (step 4 ì½”ë“œëŠ” ë³€ê²½ ì—†ìŒ) ...
        const leadership = Math.floor(state.totalBudget * state.leadershipRatio / 100);
        const job = Math.floor(state.totalBudget * state.jobRatio / 100);
        const legal = Math.floor(state.totalBudget * state.legalRatio / 100);
        const jobBudget = calculateJobEducationBudget();
        
        content.innerHTML = `
          <div class="info-card" style="background:linear-gradient(135deg,rgba(16,185,129,.2) 0%,rgba(5,150,105,.2) 100%);border-color:rgba(16,185,129,.6);">
            <div class="info-card-title" style="color:#10b981;font-size:1.1em;">ğŸ‰ ì„¤ì • ì™„ë£Œ!</div>
            <div class="info-card-content">
              ${state.year}ë…„ë„ êµìœ¡ë¹„ ì˜ˆì‚°ì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.
            </div>
          </div>
          <div class="metrics-grid" style="margin-top:20px;">
            <div class="metric-card">
              <h4>ì´ ì˜ˆì‚°</h4>
              <p>${formatNumber(state.totalBudget)}ì›</p>
              <span class="mini">${formatKRW(state.totalBudget)}</span>
            </div>
            <div class="metric-card">
              <h4>ëŒ€ìƒ ì¸ì›</h4>
              <p>${formatNumber(state.totalHeadcount)}ëª…</p>
              <span class="mini">1ì¸ë‹¹ ${formatKRW(Math.floor(state.totalBudget/state.totalHeadcount))}</span>
            </div>
            <div class="metric-card">
              <h4>ë¦¬ë”ì‹­ êµìœ¡</h4>
              <p>${formatNumber(leadership)}ì›</p>
              <span class="mini">${state.leadershipRatio}% ë°°ë¶„</span>
            </div>
            <div class="metric-card">
              <h4>ì§ë¬´ êµìœ¡</h4>
              <p>${formatNumber(job)}ì›</p>
              <span class="mini">${state.jobRatio}% ë°°ë¶„</span>
            </div>
            <div class="metric-card">
              <h4>ë²•ì •ì˜ë¬´ êµìœ¡</h4>
              <p>${formatNumber(legal)}ì›</p>
              <span class="mini">${state.legalRatio}% ë°°ë¶„</span>
            </div>
          </div>
          
          <div class="section-card" style="margin-top:24px;background:rgba(59,130,246,.1);">
            <h3 style="color:#7fb3ff;margin-bottom:16px;">ğŸ¢ ê·¼ë¬´ì§€ë³„ ì§ë¬´êµìœ¡ë¹„ ë°°ë¶€ ì˜ˆìƒ</h3>
            <table>
              <thead>
                <tr>
                  <th>ê·¼ë¬´ì§€ì—­</th>
                  <th>ì¸ì›</th>
                  <th>ê³ ê°ì‚¬ êµìœ¡ë¹„</th>
                  <th>ë¹„ì¤‘</th>
                </tr>
              </thead>
              <tbody>
                ${jobBudget.byLocation.map(loc => {
                  const ratio = jobBudget.customer > 0 ? ((loc.total / jobBudget.customer) * 100).toFixed(1) : 0;
                  return `
                    <tr>
                      <td><strong>${loc.name}</strong></td>
                      <td>${formatNumber(loc.count)}ëª…</td>
                      <td style="color:#10b981;font-weight:700;font-size:1.05em;">${formatKRW(loc.total)}</td>
                      <td>${ratio}%</td>
                    </tr>
                  `;
                }).join('')}
              </tbody>
              <tfoot style="background:rgba(31,59,110,.9);">
                <tr>
                  <th>ê³ ê°ì‚¬ êµìœ¡ í•©ê³„</th>
                  <th>${formatNumber(Object.values(state.locationDistribution).reduce((sum, loc) => sum + loc.count, 0))}ëª…</th>
                  <th style="color:#10b981;"><strong>${formatKRW(jobBudget.customer)}</strong></th>
                  <th>100%</th>
                </tr>
              </tfoot>
            </table>
            <div style="margin-top:16px;padding:12px;background:rgba(10,23,45,.6);border-radius:8px;">
              <div style="display:grid;gap:8px;">
                <div>ğŸ’¡ <strong>ê³ ê°ì‚¬ êµìœ¡ë¹„:</strong> ${formatKRW(jobBudget.customer)}</div>
                <div>ğŸ“ <strong>ì™¸ë¶€ ì „ë¬¸êµìœ¡ë¹„:</strong> ${formatKRW(jobBudget.external)} (ì£¼ì„ ${state.employeeComposition.junior}ëª… + ì„ ì„ ${state.employeeComposition.senior}ëª…)</div>
                <div style="color:#7fb3ff;">ğŸ“Š <strong>ì§ë¬´êµìœ¡ ì´ê³„:</strong> ${formatKRW(jobBudget.total)}</div>
              </div>
            </div>
          </div>
          
          <div class="info-card" style="margin-top:20px;">
            <div class="info-card-title">ğŸ“Œ ë‹¤ìŒ ë‹¨ê³„</div>
            <div class="info-card-content">
              1. <strong>êµìœ¡ê³„íš</strong> íƒ­ì—ì„œ ì„¸ë¶€ í”„ë¡œê·¸ë¨ì„ ì…ë ¥í•˜ì„¸ìš”<br>
              2. <strong>ì˜ˆì‚°ìš”ì•½</strong>ì—ì„œ ë°°ë¶„ í˜„í™©ì„ í™•ì¸í•˜ì„¸ìš”<br>
              3. <strong>ê²½ì˜ë³´ê³ ì„œ</strong>ë¥¼ ìƒì„±í•˜ì—¬ ê²½ì˜ì§„ê»˜ ë³´ê³ í•˜ì„¸ìš”
            </div>
          </div>
        `;
      }
    }

    function updateLocationInWizard(key, field, value) {
      state.locationDistribution[key][field] = Math.max(0, value);
      renderWizardStep();
    }

    function updateBudgetEstimate() {
      const el = document.getElementById('budgetEstimate');
      if (el) {
        const perPerson = Math.floor(state.totalBudget / state.totalHeadcount);
        const jobBudget = calculateJobEducationBudget();
        
        el.innerHTML = `
          ì´ ì¸ì›: <strong>${state.totalHeadcount}ëª…</strong><br>
          ì¸ë‹¹ ì—°ê°„ êµìœ¡ë¹„: <strong>${formatKRW(perPerson)}</strong><br>
          <hr style="margin:8px 0;border:none;border-top:1px solid rgba(100,145,214,.3);">
          ë¦¬ë”ì‹­ êµìœ¡ (15%): <strong>${formatKRW(Math.floor(state.totalBudget * 0.15))}</strong><br>
          ì§ë¬´ êµìœ¡ (60%): <strong>${formatKRW(Math.floor(state.totalBudget * 0.60))}</strong><br>
          ë²•ì •ì˜ë¬´ êµìœ¡ (25%): <strong>${formatKRW(Math.floor(state.totalBudget * 0.25))}</strong>
        `;
      }
    }

    function updateTotalHeadcount() {
      state.totalHeadcount = state.employeeComposition.junior + 
                            state.employeeComposition.senior + 
                            state.employeeComposition.manager + 
                            state.employeeComposition.executive;
    }

    function calculateJobEducationBudget() {
      const policy = state.jobEducationPolicy;
      const comp = state.employeeComposition;
      const locations = state.locationDistribution;
      
      let customerBudget = 0;
      Object.values(locations).forEach(loc => {
        customerBudget += loc.count * loc.customerTrainingCost;
      });
      
      const externalBudget = 
        comp.junior * policy.junior.externalSessions * policy.junior.externalUnitCost +
        comp.senior * policy.senior.externalSessions * policy.senior.externalUnitCost;
      
      return {
        customer: customerBudget,
        external: externalBudget,
        total: customerBudget + externalBudget,
        byLocation: Object.entries(locations).map(([key, loc]) => ({
          name: loc.name,
          count: loc.count,
          unitCost: loc.customerTrainingCost,
          total: loc.count * loc.customerTrainingCost
        }))
      };
    }

    document.getElementById('wizardPrev')?.addEventListener('click', () => {
      if (state.wizardStep > 1) {
        state.wizardStep--;
        renderWizardStep();
      }
    });

    document.getElementById('wizardNext')?.addEventListener('click', () => {
      if (state.wizardStep === 2) {
        const totalLocationCount = Object.values(state.locationDistribution).reduce((sum, loc) => sum + loc.count, 0);
        if (totalLocationCount !== state.totalHeadcount) {
          alert(`âš ï¸ ê·¼ë¬´ì§€ë³„ ì¸ì› í•©ê³„(${totalLocationCount}ëª…)ê°€ ì „ì²´ ì¸ì›(${state.totalHeadcount}ëª…)ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.\n\nê·¼ë¬´ì§€ë³„ ì¸ì›ì„ ì¡°ì •í•´ì£¼ì„¸ìš”.`);
          return;
        }
      }
      
      if (state.wizardStep < 4) {
        state.wizardStep++;
        renderWizardStep();
      }
    });

    document.getElementById('wizardFinish')?.addEventListener('click', () => {
      state.wizardCompleted = true;
      document.getElementById('wizardOverlay').classList.remove('active');
      initializeWithWizardData();
      switchTab('plan');
    });

    function initializeWithWizardData() {
      const jobBudget = calculateJobEducationBudget();
      const comp = state.employeeComposition;
      const hier = state.hierarchyPrograms;
      
      state.programs = [
        {
          id: 1,
          category: 'leadership',
          name: 'ì„ì› ë¦¬ë”ì‹­ ì›Œí¬ìƒµ',
          headcount: comp.executive,
          rounds: 2,
          unitCost: 800000,
          description: 'ì „ëµì  ì˜ì‚¬ê²°ì • ë° ì¡°ì§ ê´€ë¦¬',
          executionQuarter: 2, // â­ NEW
          strategicGoal: 'leadership' // â­ NEW
        },
        {
          id: 2,
          category: 'leadership',
          name: 'ì±…ì„ê¸‰ ë¦¬ë”ì‹­ ê³¼ì •',
          headcount: comp.manager,
          rounds: 2,
          unitCost: 600000,
          description: 'íŒ€ ë¹Œë”© ë° ì½”ì¹­ ìŠ¤í‚¬',
          executionQuarter: 3, // â­ NEW
          strategicGoal: 'leadership' // â­ NEW
        },
        {
          id: 3,
          category: 'job',
          name: 'ê³ ê°ì‚¬ ì§ë¬´êµìœ¡ (ì§€ì—­ë³„)',
          headcount: comp.junior + comp.senior + comp.manager,
          rounds: 1,
          unitCost: Math.floor(jobBudget.customer / (comp.junior + comp.senior + comp.manager || 1)),
          description: 'ì˜ì²œ/ê²½ì‚°/ì˜ˆì‚°/ì•ˆì–‘ ì§€ì—­ë³„ ê³ ê°ì‚¬ êµìœ¡',
          isCustomerTraining: true,
          executionQuarter: 1, // â­ NEW
          strategicGoal: 'job' // â­ NEW
        },
        {
          id: 4,
          category: 'job',
          name: 'ì™¸ë¶€ ì „ë¬¸êµìœ¡ (ì£¼ì„/ì„ ì„)',
          headcount: comp.junior + comp.senior,
          rounds: 2,
          unitCost: Math.floor(jobBudget.external / ((comp.junior + comp.senior) * 2 || 1)),
          description: 'ì™¸ë¶€ ì „ë¬¸ê¸°ê´€ êµìœ¡ (ì£¼ì„/ì„ ì„ ì—­ëŸ‰ ê°•í™”)',
          isExternalTraining: true,
          executionQuarter: 2, // â­ NEW
          strategicGoal: 'digital' // â­ NEW
        },
        {
          id: 5,
          category: 'hierarchy',
          name: hier.newEmployee.name,
          headcount: hier.newEmployee.count,
          rounds: 1,
          unitCost: hier.newEmployee.unitCost,
          description: 'ì‹ ê·œ ì…ì‚¬ì ëŒ€ìƒ íšŒì‚¬ ì†Œê°œ ë° ì§ë¬´ ê¸°ì´ˆ',
          executionQuarter: 1, // â­ NEW
          strategicGoal: 'culture' // â­ NEW
        },
        {
          id: 6,
          category: 'hierarchy',
          name: hier.retirement.name,
          headcount: hier.retirement.count,
          rounds: 1,
          unitCost: hier.retirement.unitCost,
          description: 'ì •ë…„í‡´ì§ ì˜ˆì •ì ëŒ€ìƒ ì œ2ì˜ ì¸ìƒ ì„¤ê³„',
          executionQuarter: 4, // â­ NEW
          strategicGoal: 'culture' // â­ NEW
        },
        {
          id: 7,
          category: 'legal',
          name: 'ì‚°ì—…ì•ˆì „ë³´ê±´êµìœ¡',
          headcount: state.totalHeadcount,
          rounds: 1,
          unitCost: 80000,
          description: 'ë²•ì •ì˜ë¬´ ì—°ê°„ 8ì‹œê°„',
          executionQuarter: 1, // â­ NEW
          strategicGoal: 'compliance' // â­ NEW
        },
        {
          id: 8,
          category: 'legal',
          name: 'ì§ì¥ ë‚´ ê´´ë¡­í˜ ì˜ˆë°©',
          headcount: state.totalHeadcount,
          rounds: 1,
          unitCost: 50000,
          description: 'ë²•ì •ì˜ë¬´ ì—°ê°„ 1ì‹œê°„',
          executionQuarter: 2, // â­ NEW
          strategicGoal: 'compliance' // â­ NEW
        }
      ];
      renderAllTabs();
      autoSave();
    }

    // íƒ­ ì „í™˜
    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      event?.currentTarget?.classList.add('active');
      
      const targetTab = Array.from(document.querySelectorAll('.tab')).find(t => 
        t.textContent.includes(tabName === 'quick' ? 'ë¹ ë¥¸ì‹œì‘' : 
                              tabName === 'employee' ? 'ì§ì›êµ¬ì„±' :
                              tabName === 'location' ? 'ê·¼ë¬´ì§€ì—­' :
                              tabName === 'plan' ? 'êµìœ¡ê³„íš' :
                              tabName === 'summary' ? 'ì˜ˆì‚°ìš”ì•½' :
                              tabName === 'dashboard' ? 'ëŒ€ì‹œë³´ë“œ' :
                              tabName === 'report' ? 'ê²½ì˜ë³´ê³ ì„œ' : 'ê³ ê¸‰ì„¤ì •')
      );
      if (targetTab) targetTab.classList.add('active');
      
      document.getElementById(tabName)?.classList.add('active');
      
      if (tabName === 'quick') renderQuickStart();
      if (tabName === 'employee') renderEmployee();
      if (tabName === 'location') renderLocation();
      if (tabName === 'plan') renderPlan();
      if (tabName === 'summary') renderSummary();
      if (tabName === 'dashboard') renderDashboard();
      if (tabName === 'report') renderReport();
      if (tabName === 'advanced') renderAdvanced();
    }

    // ê·¼ë¬´ì§€ì—­ ê´€ë¦¬
    function renderLocation() {
      // ... (ì½”ë“œëŠ” ë³€ê²½ ì—†ìŒ) ...
      const el = document.getElementById('location');
      if (!el) return;

      const locations = state.locationDistribution;
      const totalLocationCount = Object.values(locations).reduce((sum, loc) => sum + loc.count, 0);
      const jobBudget = calculateJobEducationBudget();

      el.innerHTML = `
        <div class="section-card">
          <div class="section-header">
            <div>
              <h2>ğŸ¢ ê·¼ë¬´ì§€ì—­ë³„ ê´€ë¦¬</h2>
              <div class="section-desc">ì§€ì—­ë³„ ì¸ì›ê³¼ ê³ ê°ì‚¬ êµìœ¡ë¹„ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤</div>
            </div>
          </div>

          <div class="info-card">
            <div class="info-card-title">ğŸ“ ê·¼ë¬´ì§€ì—­ë³„ ê³ ê°ì‚¬ êµìœ¡</div>
            <div class="info-card-content">
              ê° ì§€ì—­ì—ì„œ ì§„í–‰ë˜ëŠ” ê³ ê°ì‚¬ ì§ë¬´êµìœ¡ì˜ ë‹¨ê°€ê°€ ë‹¤ë¦…ë‹ˆë‹¤.<br>
              ì§€ì—­ë³„ ì¸ì›ê³¼ ë‹¨ê°€ë¥¼ ì„¤ì •í•˜ë©´ ìë™ìœ¼ë¡œ ì˜ˆì‚°ì´ ê³„ì‚°ë©ë‹ˆë‹¤.
            </div>
          </div>

          <div class="metrics-grid" style="margin-top:24px;">
            ${Object.entries(locations).map(([key, loc]) => `
              <div class="metric-card" style="background:linear-gradient(135deg,rgba(59,130,246,.3) 0%,rgba(29,78,216,.3) 100%);">
                <h4>ğŸ“ ${loc.name}</h4>
                <p>${formatNumber(loc.count)}ëª…</p>
                <span class="mini">ë‹¨ê°€: ${formatKRW(loc.customerTrainingCost)}</span>
              </div>
            `).join('')}
          </div>

          <div class="section-card" style="margin-top:32px;background:rgba(16,185,129,.1);">
            <h3 style="color:var(--success);margin-bottom:16px;">ğŸ’° íŒ€ë³„ ë°°ë¶€ ì˜ˆìƒ ê¸ˆì•¡</h3>
            <div class="info-card" style="margin-bottom:16px;">
              <div class="info-card-title">ğŸ“Š ì§€ì—­ë³„ êµìœ¡ë¹„ ë¶„ì„</div>
              <div class="info-card-content">
                ê° ê·¼ë¬´ì§€(íŒ€)ì— ë°°ë¶€ë  ê³ ê°ì‚¬ êµìœ¡ë¹„ë¥¼ ë¯¸ë¦¬ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
                ì‹¤ì œ ë°°ë¶€ ì‹œ ì´ ê¸ˆì•¡ì„ ê¸°ì¤€ìœ¼ë¡œ íŒ€ë³„ êµìœ¡ ìš´ì˜ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ì§€ì—­</th>
                  <th>ì¸ì›</th>
                  <th>ë‹¨ê°€</th>
                  <th>ë°°ë¶€ ì˜ˆìƒì•¡</th>
                  <th>ì „ì²´ ëŒ€ë¹„ ë¹„ì¤‘</th>
                </tr>
              </thead>
              <tbody>
                ${jobBudget.byLocation.map(loc => {
                  const ratio = jobBudget.customer > 0 ? ((loc.total / jobBudget.customer) * 100).toFixed(1) : 0;
                  return `
                    <tr>
                      <td><strong>ğŸ¢ ${loc.name}</strong></td>
                      <td>${formatNumber(loc.count)}ëª…</td>
                      <td>${formatKRW(loc.unitCost)}</td>
                      <td style="color:#10b981;font-weight:700;font-size:1.05em;">${formatKRW(loc.total)}</td>
                      <td>${ratio}%</td>
                    </tr>
                  `;
                }).join('')}
              </tbody>
              <tfoot style="background:rgba(31,59,110,.9);">
                <tr>
                  <th colspan="2">ê³ ê°ì‚¬ êµìœ¡ í•©ê³„</th>
                  <th></th>
                  <th style="color:#10b981;"><strong>${formatKRW(jobBudget.customer)}</strong></th>
                  <th>100%</th>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      `;
    }

    function updateLocation(key, field, value) {
      state.locationDistribution[key][field] = Math.max(0, value);
      autoSave();
      renderLocation();
      renderSummary();
    }

    // ì§ì› êµ¬ì„± ê´€ë¦¬
    function renderEmployee() {
      // ... (ì½”ë“œëŠ” ë³€ê²½ ì—†ìŒ) ...
      const el = document.getElementById('employee');
      if (!el) return;

      const comp = state.employeeComposition;
      const policy = state.jobEducationPolicy;
      const jobBudget = calculateJobEducationBudget();

      el.innerHTML = `
        <div class="section-card">
          <div class="section-header">
            <div>
              <h2>ğŸ‘¥ ì§ì› êµ¬ì„± ê´€ë¦¬</h2>
              <div class="section-desc">ì§ê¸‰ë³„ ì¸ì›ê³¼ êµìœ¡ ì •ì±…ì„ ê´€ë¦¬í•©ë‹ˆë‹¤</div>
            </div>
          </div>

          <div class="info-card">
            <div class="info-card-title">ğŸ“‹ ì§ê¸‰ë³„ êµìœ¡ ì •ì±…</div>
            <div class="info-card-content">
              <strong>ì£¼ì„/ì„ ì„</strong>ì€ ê³ ê°ì‚¬ êµìœ¡ + ì™¸ë¶€ ì „ë¬¸êµìœ¡ ëŒ€ìƒì…ë‹ˆë‹¤ (ì—° 2íšŒ).<br>
              <strong>ì±…ì„</strong>ì€ ê³ ê°ì‚¬ êµìœ¡ë§Œ ìˆ˜ê°•í•©ë‹ˆë‹¤.<br>
              <strong>ì„ì›</strong>ì€ ë¦¬ë”ì‹­ êµìœ¡ ëŒ€ìƒì…ë‹ˆë‹¤.
            </div>
          </div>

          <div class="metrics-grid" style="margin-top:24px;">
            <div class="metric-card" style="background:linear-gradient(135deg,rgba(251,191,36,.3) 0%,rgba(245,158,11,.3) 100%);">
              <h4>â­ ì£¼ì„</h4>
              <p>${formatNumber(comp.junior)}ëª…</p>
              <span class="mini">ê³ ê°ì‚¬ + ì™¸ë¶€ êµìœ¡</span>
            </div>
            <div class="metric-card" style="background:linear-gradient(135deg,rgba(139,92,246,.3) 0%,rgba(109,40,217,.3) 100%);">
              <h4>â­â­ ì„ ì„</h4>
              <p>${formatNumber(comp.senior)}ëª…</p>
              <span class="mini">ê³ ê°ì‚¬ + ì™¸ë¶€ êµìœ¡</span>
            </div>
            <div class="metric-card" style="background:linear-gradient(135deg,rgba(59,130,246,.3) 0%,rgba(29,78,216,.3) 100%);">
              <h4>ğŸ‘” ì±…ì„</h4>
              <p>${formatNumber(comp.manager)}ëª…</p>
              <span class="mini">ê³ ê°ì‚¬ êµìœ¡ë§Œ</span>
            </div>
            <div class="metric-card" style="background:linear-gradient(135deg,rgba(16,185,129,.3) 0%,rgba(5,150,105,.3) 100%);">
              <h4>ğŸ’¼ ì„ì›</h4>
              <p>${formatNumber(comp.executive)}ëª…</p>
              <span class="mini">ë¦¬ë”ì‹­ êµìœ¡</span>
            </div>
          </div>

          <div class="section-card" style="margin-top:32px;background:rgba(24,48,88,.6);">
            <h3 style="color:#7fb3ff;margin-bottom:16px;">ğŸ“Š ì§ê¸‰ë³„ ì¸ì› ì„¤ì •</h3>
            <table>
              <thead>
                <tr>
                  <th>ì§ê¸‰</th>
                  <th>ì¸ì›</th>
                  <th>ê³ ê°ì‚¬ êµìœ¡</th>
                  <th>ì™¸ë¶€ êµìœ¡ íšŸìˆ˜</th>
                  <th>ì™¸ë¶€ êµìœ¡ ë‹¨ê°€</th>
                  <th>ì˜ˆìƒ ì˜ˆì‚°</th>
                </tr>
              </thead>
              <tbody>
                <tr style="background:rgba(251,191,36,.1);">
                  <td><strong>ì£¼ì„ â­</strong></td>
                  <td><input type="number" value="${comp.junior}" onchange="updateEmployeeCount('junior',+this.value)" style="width:80px;" min="0"></td>
                  <td>âœ“</td>
                  <td><input type="number" value="${policy.junior.externalSessions}" onchange="updatePolicy('junior','externalSessions',+this.value)" style="width:60px;" min="0"></td>
                  <td><input type="text" value="${formatNumber(policy.junior.externalUnitCost)}" onchange="updatePolicy('junior','externalUnitCost',Number(this.value.replace(/,/g,'')))" style="width:100px;"></td>
                  <td><strong>${formatKRW(comp.junior * policy.junior.externalSessions * policy.junior.externalUnitCost)}</strong></td>
                </tr>
                <tr style="background:rgba(139,92,246,.1);">
                  <td><strong>ì„ ì„ â­â­</strong></td>
                  <td><input type="number" value="${comp.senior}" onchange="updateEmployeeCount('senior',+this.value)" style="width:80px;" min="0"></td>
                  <td>âœ“</td>
                  <td><input type="number" value="${policy.senior.externalSessions}" onchange="updatePolicy('senior','externalSessions',+this.value)" style="width:60px;" min="0"></td>
                  <td><input type="text" value="${formatNumber(policy.senior.externalUnitCost)}" onchange="updatePolicy('senior','externalUnitCost',Number(this.value.replace(/,/g,'')))" style="width:100px;"></td>
                  <td><strong>${formatKRW(comp.senior * policy.senior.externalSessions * policy.senior.externalUnitCost)}</strong></td>
                </tr>
                <tr>
                  <td><strong>ì±…ì„</strong></td>
                  <td><input type="number" value="${comp.manager}" onchange="updateEmployeeCount('manager',+this.value)" style="width:80px;" min="0"></td>
                  <td>âœ“</td>
                  <td>-</td>
                  <td>-</td>
                  <td><strong>ê³ ê°ì‚¬ êµìœ¡ë§Œ</strong></td>
                </tr>
                <tr>
                  <td><strong>ì„ì›</strong></td>
                  <td><input type="number" value="${comp.executive}" onchange="updateEmployeeCount('executive',+this.value)" style="width:80px;" min="0"></td>
                  <td>-</td>
                  <td>-</td>
                  <td>-</td>
                  <td><strong>ë¦¬ë”ì‹­ êµìœ¡ ë³„ë„</strong></td>
                </tr>
              </tbody>
              <tfoot style="background:rgba(31,59,110,.9);">
                <tr>
                  <th>í•©ê³„</th>
                  <th>${formatNumber(state.totalHeadcount)}ëª…</th>
                  <th colspan="3"></th>
                  <th><strong>${formatKRW(jobBudget.external)}</strong></th>
                </tr>
              </tfoot>
            </table>
          </div>

          <div class="section-card" style="margin-top:32px;background:rgba(16,185,129,.1);">
            <h3 style="color:var(--success);margin-bottom:16px;">ğŸ’° ì§ë¬´êµìœ¡ë¹„ ìë™ ê³„ì‚°</h3>
            <div class="metrics-grid">
              <div class="metric-card">
                <h4>ğŸ¢ ê³ ê°ì‚¬ êµìœ¡</h4>
                <p>${formatKRW(jobBudget.customer)}</p>
                <span class="mini">ì£¼ì„/ì„ ì„/ì±…ì„ ëŒ€ìƒ</span>
              </div>
              <div class="metric-card">
                <h4>ğŸ“ ì™¸ë¶€ ì „ë¬¸êµìœ¡</h4>
                <p>${formatKRW(jobBudget.external)}</p>
                <span class="mini">ì£¼ì„ ${comp.junior}ëª… + ì„ ì„ ${comp.senior}ëª…</span>
              </div>
              <div class="metric-card" style="background:linear-gradient(135deg,rgba(16,185,129,.4) 0%,rgba(5,150,105,.4) 100%);">
                <h4>ğŸ’¼ ì§ë¬´êµìœ¡ ì´ê³„</h4>
                <p>${formatKRW(jobBudget.total)}</p>
                <span class="mini">1ì¸ë‹¹ í‰ê·  ${formatKRW(Math.floor(jobBudget.total / (comp.junior + comp.senior + comp.manager || 1)))}</span>
              </div>
            </div>
          </div>
        </div>
      `;
    }

    function updateEmployeeCount(rank, count) {
      state.employeeComposition[rank] = Math.max(0, count);
      updateTotalHeadcount();
      autoSave();
      renderEmployee();
      renderSummary();
    }

    function updatePolicy(rank, field, value) {
      state.jobEducationPolicy[rank][field] = Math.max(0, value);
      autoSave();
      renderEmployee();
      renderSummary();
    }

    // ë¹ ë¥¸ ì‹œì‘
    function renderQuickStart() {
      // ... (ì½”ë“œëŠ” ë³€ê²½ ì—†ìŒ) ...
      const el = document.getElementById('quick');
      if (!el) return;
      
      const total = calculateTotal();
      const isSetup = state.wizardCompleted;
      
      el.innerHTML = `
        <div class="section-card">
          <div class="section-header">
            <div>
              <h2>ğŸš€ ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ</h2>
              <div class="section-desc">4ë‹¨ê³„ë¡œ ì™„ì„±í•˜ëŠ” êµìœ¡ë¹„ ì˜ˆì‚°</div>
            </div>
          </div>
          
          ${!isSetup ? `
          <div class="info-card" style="background:linear-gradient(135deg,rgba(251,191,36,.15) 0%,rgba(245,158,11,.15) 100%);border-color:rgba(251,191,36,.4);">
            <div class="info-card-title" style="color:#fbbf24;">âš¡ ì•„ì§ ì„¤ì •ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤</div>
            <div class="info-card-content">
              <strong>ì„¤ì • ë§ˆë²•ì‚¬</strong>ë¥¼ ì‹¤í–‰í•˜ì—¬ ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”. 5ë¶„ì´ë©´ ì¶©ë¶„í•©ë‹ˆë‹¤!
            </div>
          </div>
          <button class="button button-primary" onclick="showWizard()" style="margin-top:16px;">
            ğŸ§™ ì„¤ì • ë§ˆë²•ì‚¬ ì‹œì‘í•˜ê¸°
          </button>
          ` : `
          <div class="metrics-grid">
            <div class="metric-card">
              <h4>ğŸ“… ì˜ˆì‚° ì—°ë„</h4>
              <p>${state.year}ë…„</p>
            </div>
            <div class="metric-card">
              <h4>ğŸ‘¥ ëŒ€ìƒ ì¸ì›</h4>
              <p>${formatNumber(state.totalHeadcount)}ëª…</p>
            </div>
            <div class="metric-card">
              <h4>ğŸ’° ì´ ì˜ˆì‚°</h4>
              <p>${formatNumber(total)}ì›</p>
              <span class="mini">${formatKRW(total)}</span>
            </div>
            <div class="metric-card">
              <h4>ğŸ“š í”„ë¡œê·¸ë¨ ìˆ˜</h4>
              <p>${state.programs.length}ê°œ</p>
            </div>
          </div>
          `}
          
          <div class="section-card" style="margin-top:24px;background:rgba(24,48,88,.6);">
            <h3 style="color:#7fb3ff;margin-bottom:16px;">ğŸ“‹ ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸</h3>
            <div style="display:grid;gap:12px;">
              <div style="display:flex;align-items:center;gap:12px;padding:12px;background:rgba(10,23,45,.6);border-radius:8px;">
                <span style="font-size:1.5em;">${isSetup ? 'âœ…' : 'â¬œ'}</span>
                <div>
                  <strong>1ë‹¨ê³„: ê¸°ë³¸ ì„¤ì •</strong>
                  <div style="font-size:.85em;color:#9cb5e9;">ì—°ë„, ì¸ì›, ì´ ì˜ˆì‚°, â­ì „ë…„ ì˜ˆì‚° ì…ë ¥</div>
                </div>
              </div>
              <div style="display:flex;align-items:center;gap:12px;padding:12px;background:rgba(10,23,45,.6);border-radius:8px;">
                <span style="font-size:1.5em;">${isSetup ? 'âœ…' : 'â¬œ'}</span>
                <div>
                  <strong>2ë‹¨ê³„: ì§ì›/ê·¼ë¬´ì§€ ì„¤ì •</strong>
                  <div style="font-size:.85em;color:#9cb5e9;">ì§ê¸‰ë³„, ì§€ì—­ë³„ ì¸ì› ë° ë‹¨ê°€ ì„¤ì •</div>
                </div>
              </div>
              <div style="display:flex;align-items:center;gap:12px;padding:12px;background:rgba(10,23,45,.6);border-radius:8px;">
                <span style="font-size:1.5em;">${state.programs.length > 0 ? 'âœ…' : 'â¬œ'}</span>
                <div>
                  <strong>3ë‹¨ê³„: êµìœ¡ê³„íš ì…ë ¥</strong>
                  <div style="font-size:.85em;color:#9cb5e9;">í”„ë¡œê·¸ë¨ë³„ ìƒì„¸, â­ì „ëµëª©í‘œ, â­ìˆ˜í–‰ë¶„ê¸° ì…ë ¥</div>
                </div>
              </div>
              <div style="display:flex;align-items:center;gap:12px;padding:12px;background:rgba(10,23,45,.6);border-radius:8px;">
                <span style="font-size:1.5em;">â¬œ</span>
                <div>
                  <strong>4ë‹¨ê³„: ë³´ê³ ì„œ ìƒì„±</strong>
                  <div style="font-size:.85em;color:#9cb5e9;">ê²½ì˜ì§„ ë³´ê³ ìš© ë¬¸ì„œ ë‹¤ìš´ë¡œë“œ</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="section-card">
          <h2>ğŸ’¡ í™œìš© íŒ</h2>
          <div style="display:grid;gap:16px;margin-top:16px;">
            <div class="info-card">
              <div class="info-card-title">ğŸ“Š ì˜ˆì‚° ë°°ë¶„ ê°€ì´ë“œ</div>
              <div class="info-card-content">
                <strong>ë¦¬ë”ì‹­ êµìœ¡:</strong> 10~20% (ì„ì›Â·ê´€ë¦¬ì ëŒ€ìƒ)<br>
                <strong>ì§ë¬´ êµìœ¡:</strong> 50~70% (ì „ ì§ì› ì—­ëŸ‰ ê°•í™”)<br>
                <strong>ë²•ì •ì˜ë¬´:</strong> 20~30% (ì‚°ì—…ì•ˆì „, ì„±í¬ë¡±ì˜ˆë°© ë“±)
              </div>
            </div>
            <div class="info-card">
              <div class="info-card-title">ğŸ’° ë‹¨ê°€ ì°¸ê³ í‘œ</div>
              <div class="info-card-content">
                <strong>ì„ì› êµìœ¡:</strong> 80~100ë§Œì›/íšŒ<br>
                <strong>íŒ€ì¥ êµìœ¡:</strong> 50~70ë§Œì›/íšŒ<br>
                <strong>ì§ì› êµìœ¡:</strong> 30~50ë§Œì›/íšŒ<br>
                <strong>ë²•ì •êµìœ¡:</strong> 5~10ë§Œì›/ì¸
              </div>
            </div>
          </div>
        </div>
      `;
    }

    // êµìœ¡ê³„íš ë Œë”ë§ (ê°„ëµí™”ëœ ë²„ì „)
    function renderPlan() {
      const el = document.getElementById('plan');
      if (!el) return;

      const byCategory = {
        leadership: state.programs.filter(p => p.category === 'leadership'),
        job: state.programs.filter(p => p.category === 'job'),
        hierarchy: state.programs.filter(p => p.category === 'hierarchy'),
        legal: state.programs.filter(p => p.category === 'legal')
      };

      el.innerHTML = `
        <div class="section-card">
          <div class="section-header">
            <div>
              <h2>ğŸ“š êµìœ¡ í”„ë¡œê·¸ë¨ ê´€ë¦¬</h2>
              <div class="section-desc">ê° í”„ë¡œê·¸ë¨ì˜ ì¸ì›, íšŸìˆ˜, ë‹¨ê°€ë¥¼ ì…ë ¥í•˜ê³  â­ì „ëµëª©í‘œì™€ â­ìˆ˜í–‰ë¶„ê¸°ë¥¼ ì„¤ì •í•˜ì„¸ìš”</div>
            </div>
            <button class="button button-primary" onclick="addProgram()">+ í”„ë¡œê·¸ë¨ ì¶”ê°€</button>
          </div>
          
          ${renderProgramCategory('leadership', 'ğŸ¯ ë¦¬ë”ì‹­ êµìœ¡', byCategory.leadership)}
          ${renderProgramCategory('job', 'ğŸ’¼ ì§ë¬´ êµìœ¡', byCategory.job)}
          ${renderProgramCategory('hierarchy', 'ğŸ‘¥ ê³„ì¸µë³„ êµìœ¡', byCategory.hierarchy)}
          ${renderProgramCategory('legal', 'âš–ï¸ ë²•ì •ì˜ë¬´ êµìœ¡', byCategory.legal)}
        </div>
      `;
    }

    function renderProgramCategory(category, title, programs) {
      const total = programs.reduce((sum, p) => sum + (p.headcount * p.rounds * p.unitCost), 0);
      
      const strategyOptions = Object.entries(STRATEGY_GOALS)
        .map(([key, label]) => `<option value="${key}">${label}</option>`)
        .join('');
      
      return `
        <div class="toggle-section" style="margin-top:24px;">
          <div class="toggle-header" onclick="toggleSection(event)">
            <span class="toggle-icon">â–¼</span>
            <h3 style="flex:1;">${title}</h3>
            <span class="info-badge">
              ${programs.length}ê°œ í”„ë¡œê·¸ë¨ Â· ${formatKRW(total)}
            </span>
          </div>
          <div class="toggle-content">
            <table style="margin-top:16px;">
              <thead>
                <tr>
                  <th>í”„ë¡œê·¸ë¨ëª…</th>
                  <th>ëŒ€ìƒì¸ì›</th>
                  <th>ì—°ê°„íšŸìˆ˜</th>
                  <th>íšŒë‹¹ ë‹¨ê°€</th>
                  <th>ì†Œê³„</th>
                  <th>â­ì „ëµëª©í‘œ</th>
                  <th>â­ìˆ˜í–‰ë¶„ê¸°</th>
                  <th>ì‚­ì œ</th>
                </tr>
              </thead>
              <tbody>
                ${programs.map(p => {
                  const subtotal = p.headcount * p.rounds * p.unitCost;
                  return `
                    <tr>
                      <td><input type="text" value="${p.name}" onchange="updateProgram(${p.id},'name',this.value)" style="min-width:150px;"></td>
                      <td><input type="number" value="${p.headcount}" onchange="updateProgram(${p.id},'headcount',+this.value)" min="0" style="width:70px;"></td>
                      <td><input type="number" value="${p.rounds}" onchange="updateProgram(${p.id},'rounds',+this.value)" min="1" style="width:60px;"></td>
                      <td><input type="text" value="${formatNumber(p.unitCost)}" onchange="updateProgram(${p.id},'unitCost',Number(this.value.replace(/,/g,'')))" style="width:100px;"></td>
                      <td><strong>${formatNumber(subtotal)}</strong></td>
                      <td>
                        <select onchange="updateProgram(${p.id},'strategicGoal',this.value)" style="width:120px;">
                          ${Object.entries(STRATEGY_GOALS)
                            .map(([key, label]) => `<option value="${key}" ${p.strategicGoal === key ? 'selected' : ''}>${label}</option>`)
                            .join('')}
                        </select>
                      </td>
                      <td>
                        <select onchange="updateProgram(${p.id},'executionQuarter',this.value)" style="width:80px;">
                          <option value="1" ${p.executionQuarter == 1 ? 'selected' : ''}>1ë¶„ê¸°</option>
                          <option value="2" ${p.executionQuarter == 2 ? 'selected' : ''}>2ë¶„ê¸°</option>
                          <option value="3" ${p.executionQuarter == 3 ? 'selected' : ''}>3ë¶„ê¸°</option>
                          <option value="4" ${p.executionQuarter == 4 ? 'selected' : ''}>4ë¶„ê¸°</option>
                        </select>
                      </td>
                      <td><button class="button button-tertiary" onclick="deleteProgram(${p.id})" style="padding:6px 12px;font-size:.85em;">ì‚­ì œ</button></td>
                    </tr>
                  `;
                }).join('') || '<tr><td colspan="8" style="text-align:center;color:#9cb5e9;padding:20px;">í”„ë¡œê·¸ë¨ì„ ì¶”ê°€í•˜ì„¸ìš”</td></tr>'}
              </tbody>
            </table>
            <button class="button button-secondary" onclick="addProgramToCategory('${category}')" style="margin-top:12px;">
              + ${title} ì¶”ê°€
            </button>
          </div>
        </div>
      `;
    }

    function toggleSection(event) {
      const section = event.currentTarget.closest('.toggle-section');
      section.classList.toggle('collapsed');
    }

    function addProgram() {
      const id = state.programs.length > 0 ? Math.max(...state.programs.map(p => p.id)) + 1 : 1;
      state.programs.push({
        id,
        category: 'job',
        name: 'ìƒˆ í”„ë¡œê·¸ë¨',
        headcount: 0,
        rounds: 1,
        unitCost: 0,
        description: '',
        executionQuarter: 1, // â­ NEW
        strategicGoal: 'job' // â­ NEW
      });
      autoSave();
      renderPlan();
      renderSummary();
    }

    function addProgramToCategory(category) {
      const id = state.programs.length > 0 ? Math.max(...state.programs.map(p => p.id)) + 1 : 1;
      
      const defaults = {
        leadership: { name: 'ë¦¬ë”ì‹­ í”„ë¡œê·¸ë¨', goal: 'leadership' },
        job: { name: 'ì§ë¬´ í”„ë¡œê·¸ë¨', goal: 'job' },
        hierarchy: { name: 'ê³„ì¸µë³„ í”„ë¡œê·¸ë¨', goal: 'culture' },
        legal: { name: 'ë²•ì •ì˜ë¬´ í”„ë¡œê·¸ë¨', goal: 'compliance' }
      };
      
      state.programs.push({
        id,
        category,
        name: defaults[category]?.name || 'ìƒˆ í”„ë¡œê·¸ë¨',
        headcount: 0,
        rounds: 1,
        unitCost: 0,
        description: '',
        executionQuarter: 1, // â­ NEW
        strategicGoal: defaults[category]?.goal || 'other' // â­ NEW
      });
      autoSave();
      renderPlan();
      renderSummary();
    }

    function updateProgram(id, field, value) {
      const program = state.programs.find(p => p.id === id);
      if (program) {
        program[field] = value;
        autoSave();
        renderSummary();
        renderDashboard();
      }
    }

    function deleteProgram(id) {
      if (confirm('ì´ í”„ë¡œê·¸ë¨ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        state.programs = state.programs.filter(p => p.id !== id);
        autoSave();
        renderPlan();
        renderSummary();
        renderDashboard();
      }
    }

    // ì˜ˆì‚°ìš”ì•½
    function renderSummary() {
      const el = document.getElementById('summary');
      if (!el) return;

      const byCategory = {
        leadership: state.programs.filter(p => p.category === 'leadership'),
        job: state.programs.filter(p => p.category === 'job'),
        hierarchy: state.programs.filter(p => p.category === 'hierarchy'),
        legal: state.programs.filter(p => p.category === 'legal'),
        other: state.programs.filter(p => !['leadership','job','hierarchy','legal'].includes(p.category))
      };

      const totals = {
        leadership: byCategory.leadership.reduce((sum, p) => sum + (p.headcount * p.rounds * p.unitCost), 0),
        job: byCategory.job.reduce((sum, p) => sum + (p.headcount * p.rounds * p.unitCost), 0),
        hierarchy: byCategory.hierarchy.reduce((sum, p) => sum + (p.headcount * p.rounds * p.unitCost), 0),
        legal: byCategory.legal.reduce((sum, p) => sum + (p.headcount * p.rounds * p.unitCost), 0),
        other: byCategory.other.reduce((sum, p) => sum + (p.headcount * p.rounds * p.unitCost), 0)
      };

      const grandTotal = totals.leadership + totals.job + totals.hierarchy + totals.legal + totals.other;
      const variance = state.totalBudget - grandTotal;
      const variancePercent = state.totalBudget > 0 ? ((variance / state.totalBudget) * 100).toFixed(1) : 0;
      
      // â­ NEW: YoY ê³„ì‚°
      let yoyPercent = 0;
      let yoyColor = 'rgba(16,185,129,.3)';
      let yoyIcon = 'â–';
      if (state.previousYearBudget > 0) {
        yoyPercent = ((grandTotal - state.previousYearBudget) / state.previousYearBudget) * 100;
        if (yoyPercent > 0) {
          yoyColor = 'rgba(239,68,68,.3)'; // ì´ˆê³¼
          yoyIcon = 'â–²';
        } else if (yoyPercent < 0) {
          yoyColor = 'rgba(16,185,129,.3)'; // ì ˆê°
          yoyIcon = 'â–¼';
        }
      }
      
      // ì¹´í…Œê³ ë¦¬ ìˆœì„œ ì •ì˜ (ë¦¬ë”ì‹­ â†’ ì§ë¬´ â†’ ê³„ì¸µ â†’ ë²•ì • â†’ ê¸°íƒ€)
      const categoryOrder = ['leadership', 'job', 'hierarchy', 'legal', 'other'];
      const categoryLabels = {
        leadership: 'ğŸ¯ ë¦¬ë”ì‹­',
        job: 'ğŸ’¼ ì§ë¬´',
        hierarchy: 'ğŸ‘¥ ê³„ì¸µ',
        legal: 'âš–ï¸ ë²•ì •',
        other: 'ğŸ“Œ ê¸°íƒ€'
      };
      
      // ì •ë ¬ëœ í”„ë¡œê·¸ë¨ ë°°ì—´ ìƒì„±
      const sortedPrograms = [];
      categoryOrder.forEach(category => {
        if (byCategory[category] && byCategory[category].length > 0) {
          sortedPrograms.push(...byCategory[category]);
        }
      });
      
      el.innerHTML = `
        <div class="section-card">
          <div class="section-header">
            <div>
              <h2>ğŸ’° ì˜ˆì‚° ìš”ì•½</h2>
              <div class="section-desc">ì¹´í…Œê³ ë¦¬ë³„ ì˜ˆì‚° ì§‘í–‰ í˜„í™©</div>
            </div>
          </div>

          <div class="metrics-grid" style="grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));">
            <div class="metric-card" style="background:linear-gradient(135deg,rgba(239,68,68,.3) 0%,rgba(220,38,38,.3) 100%);">
              <h4>ğŸ’µ ì´ í™•ë³´ ì˜ˆì‚°</h4>
              <p>${formatNumber(state.totalBudget)}ì›</p>
              <span class="mini">${formatKRW(state.totalBudget)}</span>
            </div>
            <div class="metric-card" style="background:linear-gradient(135deg,rgba(251,191,36,.3) 0%,rgba(245,158,11,.3) 100%);">
              <h4>ğŸ“Š ì´ ì§‘í–‰ ì˜ˆì •</h4>
              <p>${formatNumber(grandTotal)}ì›</p>
              <span class="mini">${formatKRW(grandTotal)}</span>
            </div>
            <div class="metric-card" style="background:linear-gradient(135deg,${variance >= 0 ? 'rgba(16,185,129,.3) 0%,rgba(5,150,105,.3)' : 'rgba(239,68,68,.3) 0%,rgba(220,38,38,.3)'} 100%);">
              <h4>${variance >= 0 ? 'ğŸ’š ì”ì—¬ ì˜ˆì‚°' : 'âš ï¸ ì´ˆê³¼ ê¸ˆì•¡'}</h4>
              <p>${formatNumber(Math.abs(variance))}ì›</p>
              <span class="mini">${variancePercent}% ${variance >= 0 ? 'ë‚¨ìŒ' : 'ì´ˆê³¼'}</span>
            </div>
            <div class="metric-card" style="background:linear-gradient(135deg, ${yoyColor} 0%, ${yoyColor.replace('.3', '.4')} 100%);">
              <h4>â­ ì „ë…„ ëŒ€ë¹„ (YoY)</h4>
              <p style="color:${yoyPercent > 0 ? '#ef4444' : '#10b981'};">${yoyIcon} ${yoyPercent.toFixed(1)}%</p>
              <span class="mini">ì „ë…„: ${formatKRW(state.previousYearBudget)}</span>
            </div>
          </div>
          
          <div class="metrics-grid" style="margin-top:16px;">
            <div class="metric-card" style="background:linear-gradient(135deg,rgba(139,92,246,.3) 0%,rgba(109,40,217,.3) 100%);">
              <h4>ğŸ¯ ë¦¬ë”ì‹­ êµìœ¡</h4>
              <p>${formatNumber(totals.leadership)}ì›</p>
              <span class="mini">${formatKRW(totals.leadership)}</span>
            </div>
            <div class="metric-card" style="background:linear-gradient(135deg,rgba(59,130,246,.3) 0%,rgba(29,78,216,.3) 100%);">
              <h4>ğŸ’¼ ì§ë¬´ êµìœ¡</h4>
              <p>${formatNumber(totals.job)}ì›</p>
              <span class="mini">${formatKRW(totals.job)}</span>
            </div>
            <div class="metric-card">
              <h4>ğŸ‘¥ ê³„ì¸µë³„ êµìœ¡</h4>
              <p>${formatNumber(totals.hierarchy)}ì›</p>
              <span class="mini">${formatKRW(totals.hierarchy)}</span>
            </div>
            <div class="metric-card" style="background:linear-gradient(135deg,rgba(16,185,129,.3) 0%,rgba(5,150,105,.3) 100%);">
              <h4>âš–ï¸ ë²•ì •ì˜ë¬´ êµìœ¡</h4>
              <p>${formatNumber(totals.legal)}ì›</p>
              <span class="mini">${formatKRW(totals.legal)}</span>
            </div>
          </div>

          ${variance < 0 ? `
          <div class="info-card" style="margin-top:24px;background:linear-gradient(135deg,rgba(239,68,68,.15) 0%,rgba(220,38,38,.15) 100%);border-color:rgba(239,68,68,.4);">
            <div class="info-card-title" style="color:#ef4444;">âš ï¸ ì˜ˆì‚° ì´ˆê³¼ ê²½ê³ </div>
            <div class="info-card-content">
              ê³„íšëœ êµìœ¡ë¹„ê°€ í™•ë³´ëœ ì˜ˆì‚°ì„ <strong>${formatKRW(Math.abs(variance))}</strong> ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.
              ì¼ë¶€ í”„ë¡œê·¸ë¨ì˜ ê·œëª¨ë¥¼ ì¶•ì†Œí•˜ê±°ë‚˜ ì¶”ê°€ ì˜ˆì‚° í™•ë³´ë¥¼ ê²€í† í•˜ì„¸ìš”.
            </div>
          </div>
          ` : ''}
        </div>

        <div class="section-card">
          <h2>ğŸ“‹ í”„ë¡œê·¸ë¨ë³„ ìƒì„¸ ë‚´ì—­</h2>
          <table style="margin-top:16px;">
            <thead>
              <tr>
                <th>ì¹´í…Œê³ ë¦¬</th>
                <th>í”„ë¡œê·¸ë¨ëª…</th>
                <th>ëŒ€ìƒì¸ì›</th>
                <th>ì—°ê°„íšŸìˆ˜</th>
                <th>íšŒë‹¹ ë‹¨ê°€</th>
                <th>ì†Œê³„</th>
                <th>â­ì „ëµëª©í‘œ</th>
                <th>â­ìˆ˜í–‰ë¶„ê¸°</th>
              </tr>
            </thead>
            <tbody>
              ${state.programs.map(p => {
                const subtotal = p.headcount * p.rounds * p.unitCost;
                const catLabel = p.category === 'leadership' ? 'ë¦¬ë”ì‹­' : p.category === 'job' ? 'ì§ë¬´' : p.category === 'hierarchy' ? 'ê³„ì¸µ' : 'ë²•ì •';
                return `
                  <tr>
                    <td><span class="info-badge">${catLabel}</span></td>
                    <td>${p.name}</td>
                    <td>${formatNumber(p.headcount)}ëª…</td>
                    <td>${p.rounds}íšŒ</td>
                    <td>${formatNumber(p.unitCost)}ì›</td>
                    <td><strong>${formatNumber(subtotal)}ì›</strong></td>
                    <td>${STRATEGY_GOALS[p.strategicGoal] || 'ê¸°íƒ€'}</td>
                    <td>${p.executionQuarter} ë¶„ê¸°</td>
                  </tr>
                `;
              }).join('') || '<tr><td colspan="8" style="text-align:center;color:#9cb5e9;padding:20px;">ë“±ë¡ëœ í”„ë¡œê·¸ë¨ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>'}
            </tbody>
            <tfoot style="background:rgba(31,59,110,.9);">
              <tr>
                <th colspan="5" style="text-align:right;">ì´ê³„</th>
                <th><strong>${formatNumber(grandTotal)}ì›</strong><br><span style="font-size:.8em;color:#9cb5e9;">${formatKRW(grandTotal)}</span></th>
                <th colspan="2"></th>
              </tr>
            </tfoot>
          </table>
        </div>
      `;
    }

    // ëŒ€ì‹œë³´ë“œ
    function renderDashboard() {
      const el = document.getElementById('dashboard');
      if (!el) return;
      
      // â­ NEW: ì°¨íŠ¸ ë°ì´í„° ê³„ì‚°
      const categoryTotals = { leadership: 0, job: 0, hierarchy: 0, legal: 0 };
      const strategyTotals = {};
      const quarterlyTotals = { 1: 0, 2: 0, 3: 0, 4: 0 };
      
      for(const goalKey in STRATEGY_GOALS) { strategyTotals[goalKey] = 0; }

      state.programs.forEach(p => {
        const total = p.headcount * p.rounds * p.unitCost;
        if (categoryTotals[p.category] !== undefined) {
          categoryTotals[p.category] += total;
        }
        if (strategyTotals[p.strategicGoal] !== undefined) {
          strategyTotals[p.strategicGoal] += total;
        }
        if (quarterlyTotals[p.executionQuarter] !== undefined) {
          quarterlyTotals[p.executionQuarter] += total;
        }
      });

      el.innerHTML = `
        <div class="section-card">
          <div class="section-header">
            <div>
              <h2>ğŸ“Š ì˜ˆì‚° ëŒ€ì‹œë³´ë“œ</h2>
              <div class="section-desc">ì‹œê°í™”ëœ ì˜ˆì‚° ë¶„ì„</div>
            </div>
          </div>

          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(400px,1fr));gap:24px;">
            <div>
              <h3 style="color:#7fb3ff;margin-bottom:16px;">ì¹´í…Œê³ ë¦¬ë³„ ì˜ˆì‚° ë°°ë¶„</h3>
              <div class="chart-container">
                <canvas id="categoryChart"></canvas>
              </div>
            </div>
            <div>
              <h3 style="color:#7fb3ff;margin-bottom:16px;">â­ ì „ëµëª©í‘œë³„ ì˜ˆì‚° ë°°ë¶„</h3>
              <div class="chart-container">
                <canvas id="strategyChart"></canvas>
              </div>
            </div>
            <div>
              <h3 style="color:#7fb3ff;margin-bottom:16px;">â­ ë¶„ê¸°ë³„ ì§‘í–‰ ê³„íš</h3>
              <div class="chart-container">
                <canvas id="quarterlyChart"></canvas>
              </div>
            </div>
            <div>
              <h3 style="color:#7fb3ff;margin-bottom:16px;">Top 5 ê³ ì•¡ í”„ë¡œê·¸ë¨</h3>
              <div class="chart-container">
                <canvas id="topProgramsChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      `;

      setTimeout(() => {
        renderCategoryChart(categoryTotals);
        renderStrategyChart(strategyTotals); // â­ NEW
        renderQuarterlyChart(quarterlyTotals); // â­ NEW
        renderTopProgramsChart();
      }, 100);
    }

    function renderCategoryChart(totals) {
      const ctx = document.getElementById('categoryChart');
      if (!ctx || !window.Chart) return;

      new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['ë¦¬ë”ì‹­ êµìœ¡', 'ì§ë¬´ êµìœ¡', 'ê³„ì¸µë³„ êµìœ¡', 'ë²•ì •ì˜ë¬´ êµìœ¡'],
          datasets: [{
            data: [totals.leadership, totals.job, totals.hierarchy, totals.legal],
            backgroundColor: ['#8b5cf6', '#3b82f6', '#f59e0b', '#10b981'],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: { color: '#dbe7ff', font: { size: 12 } }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.label + ': ' + formatKRW(context.raw);
                }
              }
            }
          }
        }
      });
    }

    // â­ NEW
    function renderStrategyChart(totals) {
      const ctx = document.getElementById('strategyChart');
      if (!ctx || !window.Chart) return;
      
      const labels = Object.keys(totals).map(key => STRATEGY_GOALS[key]);
      const data = Object.values(totals);

      new Chart(ctx, {
        type: 'pie',
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: ['#ef4444', '#8b5cf6', '#3b82f6', '#06b6d4', '#10b981', '#f59e0b', '#64748b'],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: { color: '#dbe7ff', font: { size: 12 } }
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return context.label + ': ' + formatKRW(context.raw);
                }
              }
            }
          }
        }
      });
    }

    // â­ NEW (modified from monthly)
    function renderQuarterlyChart(totals) {
      const ctx = document.getElementById('quarterlyChart');
      if (!ctx || !window.Chart) return;

      const data = Object.values(totals);

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: ['1ë¶„ê¸°', '2ë¶„ê¸°', '3ë¶„ê¸°', '4ë¶„ê¸°'],
          datasets: [{
            label: 'ë¶„ê¸°ë³„ ì§‘í–‰ ì˜ˆì •',
            data: data,
            backgroundColor: '#5790ff',
            borderColor: '#5790ff',
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return 'ì§‘í–‰ì•¡: ' + formatKRW(context.raw);
                }
              }
            }
          },
          scales: {
            x: { ticks: { color: '#dbe7ff' }, grid: { display: false } },
            y: { 
              ticks: { 
                color: '#dbe7ff',
                callback: function(value) {
                  return formatKRW(value);
                }
              }, 
              grid: { color: 'rgba(63,88,135,.3)' } 
            }
          }
        }
      });
    }

    function renderTopProgramsChart() {
      const ctx = document.getElementById('topProgramsChart');
      if (!ctx || !window.Chart) return;

      const sorted = [...state.programs]
        .map(p => ({ name: p.name, total: p.headcount * p.rounds * p.unitCost }))
        .sort((a, b) => b.total - a.total)
        .slice(0, 5);

      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: sorted.map(p => p.name),
          datasets: [{
            label: 'ì˜ˆì‚° (ì›)',
            data: sorted.map(p => p.total),
            backgroundColor: '#10b981',
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          indexAxis: 'y',
          plugins: {
            legend: { display: false },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return formatKRW(context.raw);
                }
              }
            }
          },
          scales: {
            x: { ticks: { color: '#dbe7ff' }, grid: { color: 'rgba(63,88,135,.3)' } },
            y: { ticks: { color: '#dbe7ff' }, grid: { display: false } }
          }
        }
      });
    }

    // ê²½ì˜ë³´ê³ ì„œ
    function renderReport() {
      const el = document.getElementById('report');
      if (!el) return;

      const categoryTotals = { leadership: 0, job: 0, hierarchy: 0, legal: 0 };
      const byCategory = { leadership: [], job: [], hierarchy: [], legal: [] };
      const strategyTotals = {};
      for(const goalKey in STRATEGY_GOALS) { strategyTotals[goalKey] = 0; }
      
      state.programs.forEach(p => {
        const total = p.headcount * p.rounds * p.unitCost;
        if (categoryTotals[p.category] !== undefined) {
          categoryTotals[p.category] += total;
          byCategory[p.category].push(p);
        }
        if (strategyTotals[p.strategicGoal] !== undefined) {
          strategyTotals[p.strategicGoal] += total;
        }
      });
      
      const grandTotal = Object.values(categoryTotals).reduce((a, b) => a + b, 0);
      const perPerson = state.totalHeadcount > 0 ? Math.floor(grandTotal / state.totalHeadcount) : 0;
      
      // â­ NEW: YoY ê³„ì‚°
      let yoyPercent = 0;
      let yoyColor = '#64748b';
      let yoyIcon = 'â–';
      if (state.previousYearBudget > 0) {
        yoyPercent = ((grandTotal - state.previousYearBudget) / state.previousYearBudget) * 100;
        if (yoyPercent > 0) {
          yoyColor = '#dc2626'; // ì´ˆê³¼
          yoyIcon = 'â–²';
        } else if (yoyPercent < 0) {
          yoyColor = '#059669'; // ì ˆê°
          yoyIcon = 'â–¼';
        }
      }

      el.innerHTML = `
        <div class="section-card">
          <div class="section-header">
            <div>
              <h2>ğŸ“„ ê²½ì˜ì§„ ë³´ê³ ì„œ</h2>
              <div class="section-desc">ì¸ì‡„ ë˜ëŠ” PDFë¡œ ì €ì¥í•˜ì„¸ìš” (Ctrl+P)</div>
            </div>
            <button class="button button-primary" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„/PDF ì €ì¥</button>
          </div>
        </div>

        <div class="section-card" style="background:#fff;color:#000;padding:48px;">
          <div style="text-align:center;margin-bottom:40px;border-bottom:3px solid #2a63ff;padding-bottom:24px;">
            <h1 style="font-size:2.2em;color:#1e40af;margin-bottom:12px;">${state.year}ë…„ë„ êµìœ¡ë¹„ ì‚¬ì—…ê³„íš</h1>
            <p style="font-size:1.1em;color:#64748b;">Education Budget Plan</p>
          </div>

          <div class="report-section">
            <h3>1. ìš”ì•½ (Executive Summary)</h3>
            <div class="report-kpi" style="grid-template-columns: repeat(3, 1fr); gap: 16px;">
              <div class="report-kpi-item" style="background:#eff6ff;">
                <span class="report-kpi-label" style="color:#1e40af;">ì´ ì˜ˆì‚° (A)</span>
                <span class="report-kpi-value" style="color:#1e3a8a;">${formatNumber(grandTotal)} ì›</span>
                <div style="font-size:.85em;color:#64748b;margin-top:4px;">${formatKRW(grandTotal)}</div>
              </div>
              <div class="report-kpi-item" style="background:#f0fdf4;">
                <span class="report-kpi-label" style="color:#15803d;">ì „ë…„ ì˜ˆì‚° (B)</span>
                <span class="report-kpi-value" style="color:#166534;">${formatNumber(state.previousYearBudget)} ì›</span>
                <div style="font-size:.85em;color:#64748b;margin-top:4px;">${formatKRW(state.previousYearBudget)}</div>
              </div>
              <div class="report-kpi-item" style="background:#fefce8;">
                <span class="report-kpi-label" style="color:#a16207;">â­ ì „ë…„ ëŒ€ë¹„ (A-B)/B</span>
                <span class="report-kpi-value" style="color:${yoyColor};">${yoyIcon} ${yoyPercent.toFixed(1)} %</span>
              </div>
              <div class="report-kpi-item" style="background:#f8fafc;">
                <span class="report-kpi-label" style="color:#334155;">ëŒ€ìƒ ì¸ì›</span>
                <span class="report-kpi-value" style="color:#1e293b;">${formatNumber(state.totalHeadcount)} ëª…</span>
              </div>
              <div class="report-kpi-item" style="background:#f8fafc;">
                <span class="report-kpi-label" style="color:#334155;">1ì¸ë‹¹ êµìœ¡ë¹„</span>
                <span class="report-kpi-value" style="color:#1e293b;">${formatKRW(perPerson)}</span>
              </div>
              <div class="report-kpi-item" style="background:#f8fafc;">
                <span class="report-kpi-label" style="color:#334155;">ì´ í”„ë¡œê·¸ë¨ ìˆ˜</span>
                <span class="report-kpi-value" style="color:#1e293b;">${state.programs.length} ê°œ</span>
              </div>
            </div>
          </div>

          <div class="report-section">
            <h3>2. ì˜ˆì‚° ë°°ë¶„ ê³„íš</h3>
            <table style="width:100%;border-collapse:collapse;margin-top:16px;">
              <thead>
                <tr style="background:#1e40af;color:#fff;">
                  <th style="padding:12px;text-align:left;border:1px solid #ddd;">êµ¬ë¶„</th>
                  <th style="padding:12px;text-align:right;border:1px solid #ddd;">ì˜ˆì‚° (ì›)</th>
                  <th style="padding:12px;text-align:right;border:1px solid #ddd;">ë¹„ì¤‘ (%)</th>
                  <th style="padding:12px;text-align:center;border:1px solid #ddd;">í”„ë¡œê·¸ë¨ ìˆ˜</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td style="padding:12px;border:1px solid #ddd;">ğŸ¯ ë¦¬ë”ì‹­ êµìœ¡</td>
                  <td style="padding:12px;text-align:right;border:1px solid #ddd;">${formatNumber(categoryTotals.leadership)}</td>
                  <td style="padding:12px;text-align:right;border:1px solid #ddd;">${grandTotal > 0 ? ((categoryTotals.leadership/grandTotal)*100).toFixed(1) : 0}%</td>
                  <td style="padding:12px;text-align:center;border:1px solid #ddd;">${byCategory.leadership.length}ê°œ</td>
                </tr>
                <tr style="background:#f8fafc;">
                  <td style="padding:12px;border:1px solid #ddd;">ğŸ’¼ ì§ë¬´ êµìœ¡</td>
                  <td style="padding:12px;text-align:right;border:1px solid #ddd;">${formatNumber(categoryTotals.job)}</td>
                  <td style="padding:12px;text-align:right;border:1px solid #ddd;">${grandTotal > 0 ? ((categoryTotals.job/grandTotal)*100).toFixed(1) : 0}%</td>
                  <td style="padding:12px;text-align:center;border:1px solid #ddd;">${byCategory.job.length}ê°œ</td>
                </tr>
                <tr>
                  <td style="padding:12px;border:1px solid #ddd;">ğŸ‘¥ ê³„ì¸µë³„ êµìœ¡</td>
                  <td style="padding:12px;text-align:right;border:1px solid #ddd;">${formatNumber(categoryTotals.hierarchy)}</td>
                  <td style="padding:12px;text-align:right;border:1px solid #ddd;">${grandTotal > 0 ? ((categoryTotals.hierarchy/grandTotal)*100).toFixed(1) : 0}%</td>
                  <td style="padding:12px;text-align:center;border:1px solid #ddd;">${byCategory.hierarchy.length}ê°œ</td>
                </tr>
                <tr style="background:#f8fafc;">
                  <td style="padding:12px;border:1px solid #ddd;">âš–ï¸ ë²•ì •ì˜ë¬´ êµìœ¡</td>
                  <td style="padding:12px;text-align:right;border:1px solid #ddd;">${formatNumber(categoryTotals.legal)}</td>
                  <td style="padding:12px;text-align:right;border:1px solid #ddd;">${grandTotal > 0 ? ((categoryTotals.legal/grandTotal)*100).toFixed(1) : 0}%</td>
                  <td style="padding:12px;text-align:center;border:1px solid #ddd;">${byCategory.legal.length}ê°œ</td>
                </tr>
                <tr style="background:#1e40af;color:#fff;font-weight:700;">
                  <td style="padding:12px;border:1px solid #ddd;">í•©ê³„</td>
                  <td style="padding:12px;text-align:right;border:1px solid #ddd;">${formatNumber(grandTotal)}</td>
                  <td style="padding:12px;text-align:right;border:1px solid #ddd;">100%</td>
                  <td style="padding:12px;text-align:center;border:1px solid #ddd;">${state.programs.length}ê°œ</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="report-section">
            <h3>3. â­ ì „ëµëª©í‘œë³„ ì˜ˆì‚° (Strategy Alignment)</h3>
            <table style="width:100%;border-collapse:collapse;margin-top:16px;">
              <thead>
                <tr style="background:#1e40af;color:#fff;">
                  <th style="padding:12px;text-align:left;border:1px solid #ddd;">ì „ëµ ëª©í‘œ</th>
                  <th style="padding:12px;text-align:right;border:1px solid #ddd;">ì˜ˆì‚° (ì›)</th>
                  <th style="padding:12px;text-align:right;border:1px solid #ddd;">ë¹„ì¤‘ (%)</th>
                </tr>
              </thead>
              <tbody>
                ${Object.entries(strategyTotals).filter(([,total]) => total > 0).map(([key, total]) => `
                  <tr style="background:#f8fafc;">
                    <td style="padding:12px;border:1px solid #ddd;">${STRATEGY_GOALS[key]}</td>
                    <td style="padding:12px;text-align:right;border:1px solid #ddd;">${formatNumber(total)}</td>
                    <td style="padding:12px;text-align:right;border:1px solid #ddd;">${grandTotal > 0 ? ((total/grandTotal)*100).toFixed(1) : 0}%</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>

          <div class="report-section">
            <h3>4. ì£¼ìš” êµìœ¡ í”„ë¡œê·¸ë¨</h3>
            
            <div style="margin-top:20px;">
              <h4 style="color:#1e40af;margin-bottom:12px;font-size:1.1em;">ê°€. ë¦¬ë”ì‹­ êµìœ¡</h4>
              <div style="background:#f8fafc;padding:16px;border-radius:8px;border:1px solid #e2e8f0;">
                ${byCategory.leadership.length > 0 ? `
                  <ul style="margin-left:20px;line-height:1.8;">
                    ${byCategory.leadership.map(p => {
                      const total = p.headcount * p.rounds * p.unitCost;
                      return `<li><strong>${p.name}</strong> (<strong>${p.executionQuarter}ë¶„ê¸°</strong>): ${p.headcount}ëª… Ã— ${p.rounds}íšŒ = ${formatKRW(total)}<br>
                      <span style="color:#64748b;font-size:.9em;">${p.description || 'ë¦¬ë”ì‹­ ì—­ëŸ‰ ê°•í™”'}</span></li>`;
                    }).join('')}
                  </ul>
                ` : '<p style="color:#64748b;">ë“±ë¡ëœ í”„ë¡œê·¸ë¨ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}
              </div>
            </div>

            <div style="margin-top:20px;">
              <h4 style="color:#1e40af;margin-bottom:12px;font-size:1.1em;">ë‚˜. ì§ë¬´ êµìœ¡</h4>
              <div style="background:#f8fafc;padding:16px;border-radius:8px;border:1px solid #e2e8f0;">
                ${byCategory.job.length > 0 ? `
                  <ul style="margin-left:20px;line-height:1.8;">
                    ${byCategory.job.map(p => {
                      const total = p.headcount * p.rounds * p.unitCost;
                      return `<li><strong>${p.name}</strong> (<strong>${p.executionQuarter}ë¶„ê¸°</strong>): ${p.headcount}ëª… Ã— ${p.rounds}íšŒ = ${formatKRW(total)}<br>
                      <span style="color:#64748b;font-size:.9em;">${p.description || 'ì§ë¬´ ì „ë¬¸ì„± í–¥ìƒ'}</span></li>`;
                    }).join('')}
                  </ul>
                ` : '<p style="color:#64748b;">ë“±ë¡ëœ í”„ë¡œê·¸ë¨ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}
              </div>
            </div>

            <div style="margin-top:20px;">
              <h4 style="color:#1e40af;margin-bottom:12px;font-size:1.1em;">ë‹¤. ë²•ì •ì˜ë¬´ êµìœ¡</h4>
              <div style="background:#f8fafc;padding:16px;border-radius:8px;border:1px solid #e2e8f0;">
                ${byCategory.legal.length > 0 ? `
                  <ul style="margin-left:20px;line-height:1.8;">
                    ${byCategory.legal.map(p => {
                      const total = p.headcount * p.rounds * p.unitCost;
                      return `<li><strong>${p.name}</strong> (<strong>${p.executionQuarter}ë¶„ê¸°</strong>): ${p.headcount}ëª… Ã— ${p.rounds}íšŒ = ${formatKRW(total)}<br>
                      <span style="color:#64748b;font-size:.9em;">${p.description || 'ë²•ì • ì¤€ìˆ˜ êµìœ¡'}</span></li>`;
                    }).join('')}
                  </ul>
                ` : '<p style="color:#64748b;">ë“±ë¡ëœ í”„ë¡œê·¸ë¨ì´ ì—†ìŠµë‹ˆë‹¤.</p>'}
              </div>
            </div>
          </div>

          <div class="report-section">
            <h3>5. ê¸°ëŒ€ íš¨ê³¼ (ì „ëµëª©í‘œ ì¤‘ì‹¬)</h3>
            <div style="background:#f8fafc;padding:20px;border-radius:8px;border:1px solid #e2e8f0;">
              <p style="margin-bottom:16px;line-height:1.7;">ë³¸ ì˜ˆì‚°ì€ ë‹¤ìŒê³¼ ê°™ì€ íšŒì‚¬ì˜ í•µì‹¬ ì „ëµ ëª©í‘œ ë‹¬ì„±ì— ê¸°ì—¬í•©ë‹ˆë‹¤.</p>
              <ul style="margin-left:20px;line-height:2;">
                ${Object.entries(strategyTotals).filter(([,total]) => total > 0).map(([key, total]) => `
                  <li><strong>${STRATEGY_GOALS[key]}</strong>: ì´ <strong>${formatKRW(total)}</strong> íˆ¬ì…ì„ í†µí•œ ì—­ëŸ‰ í™•ë³´</li>
                `).join('')}
              </ul>
            </div>
          </div>

          <div style="margin-top:48px;padding-top:24px;border-top:2px solid #e2e8f0;text-align:right;color:#64748b;">
            <p>ì‘ì„±ì¼: ${new Date().toLocaleDateString('ko-KR')}</p>
            <p style="margin-top:8px;">ì¸ì‚¬íŒ€ / êµìœ¡ë‹´ë‹¹</p>
          </div>
        </div>
      `;
    }

    // ê³ ê¸‰ì„¤ì •
    function renderAdvanced() {
      // ... (ì½”ë“œëŠ” ë³€ê²½ ì—†ìŒ) ...
      const el = document.getElementById('advanced');
      if (!el) return;

      el.innerHTML = `
        <div class="section-card">
          <div class="section-header">
            <div>
              <h2>âš™ï¸ ê³ ê¸‰ ì„¤ì •</h2>
              <div class="section-desc">ì„¸ë¶€ ì˜µì…˜ ë° ë°ì´í„° ê´€ë¦¬</div>
            </div>
          </div>

          <div class="info-card">
            <div class="info-card-title">ğŸ’¾ ë°ì´í„° ê´€ë¦¬</div>
            <div class="info-card-content">
              í˜„ì¬ ì„¤ì •ê³¼ í”„ë¡œê·¸ë¨ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê±°ë‚˜ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            </div>
          </div>

          <div style="display:flex;gap:12px;margin-top:16px;flex-wrap:wrap;">
            <button class="button button-primary" onclick="exportData()">ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸° (JSON)</button>
            <button class="button button-secondary" onclick="importData()">ğŸ“¤ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <button class="button button-success" onclick="manualSave()">ğŸ’¾ ìˆ˜ë™ ì €ì¥</button>
            <button class="button button-tertiary" onclick="clearAllData()">ğŸ”„ ì „ì²´ ì´ˆê¸°í™”</button>
          </div>

          <div class="info-card" style="margin-top:20px;">
            <div class="info-card-title">ğŸ’¡ ì €ì¥ ê¸°ëŠ¥ ì•ˆë‚´</div>
            <div class="info-card-content">
              <strong>ìë™ ì €ì¥:</strong> ë°ì´í„° ì…ë ¥ ì‹œ 2ì´ˆ í›„ ìë™ìœ¼ë¡œ ì €ì¥ë©ë‹ˆë‹¤<br>
              <strong>ìˆ˜ë™ ì €ì¥:</strong> ìƒë‹¨ì˜ 'ğŸ’¾ ì €ì¥' ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì¦‰ì‹œ ì €ì¥<br>
              <strong>ì €ì¥ ìœ„ì¹˜:</strong> ë¸Œë¼ìš°ì €ì˜ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ (ê°™ì€ ë¸Œë¼ìš°ì €ì—ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥)<br>
              <strong>ë°±ì—… ê¶Œì¥:</strong> ì¤‘ìš”í•œ ë°ì´í„°ëŠ” 'ğŸ“¥ ë°ì´í„° ë‚´ë³´ë‚´ê¸°'ë¡œ íŒŒì¼ë¡œ ì €ì¥í•˜ì„¸ìš”
            </div>
          </div>
        </div>
      `;
    }

    // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
    function calculateTotal() {
      return state.programs.reduce((sum, p) => sum + (p.headcount * p.rounds * p.unitCost), 0);
    }

    function loadSample() {
      if (confirm('ìƒ˜í”Œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ? í˜„ì¬ ë°ì´í„°ëŠ” ì‚­ì œë©ë‹ˆë‹¤.')) {
        state.year = new Date().getFullYear() + 1;
        state.totalHeadcount = 250;
        state.totalBudget = 500000000;
        state.previousYearBudget = 450000000; // â­ NEW
        state.wizardCompleted = true;
        initializeWithWizardData();
        saveToLocalStorage();
        showSaveNotification('ìƒ˜í”Œ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
        renderAllTabs();
      }
    }

    function exportData() {
      const data = JSON.stringify(state, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `êµìœ¡ë¹„ì˜ˆì‚°_${state.year}_${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showSaveNotification('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì™„ë£Œ');
    }

    function importData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      input.onchange = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
          try {
            const imported = JSON.parse(event.target.result);
            Object.assign(state, imported);
            saveToLocalStorage();
            renderAllTabs();
            showSaveNotification('ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤');
          } catch (err) {
            alert('íŒŒì¼ì„ ì½ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + err.message);
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    function clearAllData() {
      if (confirm('âš ï¸ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìœ¼ë©°,\ní˜„ì¬ ì‘ì—… ì¤‘ì¸ ëª¨ë“  ë‚´ìš©ì´ ì‚­ì œë©ë‹ˆë‹¤.')) {
        if (confirm('ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          localStorage.removeItem(STORAGE_KEY);
          // state ê°ì²´ ìì²´ë¥¼ ì´ˆê¸°í™”í•˜ì§€ ì•Šê³ , ë‚´ë¶€ ì†ì„±ì„ ë¦¬ì…‹í•©ë‹ˆë‹¤.
          Object.assign(state, {
            year: new Date().getFullYear() + 1,
            totalHeadcount: 250,
            totalBudget: 500000000,
            previousYearBudget: 450000000, // â­ NEW
            leadershipRatio: 15,
            jobRatio: 45,
            hierarchyRatio: 15,
            legalRatio: 25,
            programs: [],
            wizardStep: 1,
            wizardCompleted: false,
            lastSaved: null,
            employeeComposition: { junior: 100, senior: 80, manager: 50, executive: 20 },
            locationDistribution: {
              yeongcheon: { name: 'ì˜ì²œ', count: 120, customerTrainingCost: 300000 },
              gyeongsan: { name: 'ê²½ì‚°', count: 80, customerTrainingCost: 320000 },
              yesan: { name: 'ì˜ˆì‚°', count: 30, customerTrainingCost: 350000 },
              anyang: { name: 'ì•ˆì–‘', count: 20, customerTrainingCost: 380000 }
            },
            jobEducationPolicy: { /* ... ê¸°ë³¸ê°’ ... */ },
            hierarchyPrograms: { /* ... ê¸°ë³¸ê°’ ... */ }
          });
          
          // ê¸°ë³¸ê°’ ì¬í• ë‹¹ (ì¤‘ì²© ê°ì²´)
          state.jobEducationPolicy = {
            junior: { customerTraining: true, externalTraining: true, externalSessions: 2, externalUnitCost: 550000 },
            senior: { customerTraining: true, externalTraining: true, externalSessions: 2, externalUnitCost: 600000 },
            manager: { customerTraining: true, externalTraining: false, externalSessions: 0, externalUnitCost: 0 },
            executive: { customerTraining: false, externalTraining: false, externalSessions: 0, externalUnitCost: 0 }
          };
          state.hierarchyPrograms = {
            newEmployee: { name: 'ì‹ ì…ì‚¬ì› ì…ë¬¸êµìœ¡', count: 15, unitCost: 500000 },
            retirement: { name: 'ì •ë…„í‡´ì§ ì¬ì·¨ì—…ì§€ì›', count: 5, unitCost: 300000 }
          };

          renderAllTabs();
          updateSaveStatus();
          showSaveNotification('ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        }
      }
    }


    function renderAllTabs() {
      renderQuickStart();
      renderEmployee();
      renderLocation();
      renderPlan();
      renderSummary();
      renderDashboard();
      renderReport();
      renderAdvanced();
    }

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', () => {
      const loaded = loadFromLocalStorage();
      if (loaded) {
        console.log('ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
      }
      
      renderAllTabs();
      
      setInterval(updateSaveStatus, 60000);
      
      setTimeout(() => {
        if (!state.wizardCompleted) {
          showWizard();
        }
      }, 500);
    });

    window.addEventListener('beforeunload', (e) => {
      if (autoSaveTimer) {
        saveToLocalStorage();
      }
    });
  </script>
</body>
</html>


